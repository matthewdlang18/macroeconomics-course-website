<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real-Time Data - Principles of Macroeconomics</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.2.0/dist/chartjs-chart-matrix.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  .banner-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 25%; /* This sets the aspect ratio of the container */
    min-height: 120px; /* Minimum height on small screens */
    max-height: 400px; /* Maximum height on large screens */
    overflow: hidden;
  }
  
  .banner-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .banner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0.4);
  }
  
  /* Mobile-first responsive text sizes */
  .page-title {
    font-size: 1.5rem;
    font-weight: bold;
  }
  
  .page-subtitle {
    font-size: 1rem;
    margin-top: 0.5rem;
  }
  
  /* Medium screens */
  @media (min-width: 640px) {
    .page-title {
      font-size: 2rem;
    }
    .page-subtitle {
      font-size: 1.25rem;
    }
  }
  
  /* Large screens */
  @media (min-width: 1024px) {
    .page-title {
      font-size: 2.5rem;
    }
    .page-subtitle {
      font-size: 1.5rem;
    }
  }

  /* Navigation links in banner */
  .nav-links {
    position: absolute;
    top: 1rem;
    left: 1rem;
    display: flex;
    gap: 1rem;
  }
  
  .nav-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    font-size: 0.875rem;
    transition: color 0.2s;
  }
  
  .nav-links a:hover {
    color: white;
  }
  
  .nav-links a.active {
    color: white;
    font-weight: 500;
  }

  /* Heatmap styles */
  .heatmap-container {
    overflow-x: auto;
  }

  /* Category selector styles */
  .category-selector {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .category-btn {
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .category-btn.selected {
    background-color: #3b82f6;
    color: white;
  }
  
  .category-btn:not(.selected) {
    background-color: #f3f4f6;
    color: #374151;
  }
  
  .category-btn:hover:not(.selected) {
    background-color: #e5e7eb;
  }

  /* Tab styles */
  .tab-button {
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
  }
  
  .tab-button.active {
    border-bottom-color: #3b82f6;
    color: #3b82f6;
  }
  
  .tab-button:not(.active) {
    color: #6b7280;
  }
  
  .tab-button:hover:not(.active) {
    color: #3b82f6;
  }

  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
</style>
</head>
<body class="bg-gray-50">
<!-- Header -->
<header>
  <div class="banner-container">
    <img src="./images/banner19.png" alt="Real-Time Data Banner" class="banner-image">
    <div class="banner-overlay">
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="materials.html">Materials</a>
        <a href="real-time-data.html" class="active">Real-Time Data</a>
        <a href="faq.html">FAQ</a>
      </div>
      <div class="text-center text-white px-4">
        <h1 class="page-title">Real-Time Economic Data</h1>
        <p class="page-subtitle">Interactive Visualizations of Key Economic Indicators</p>
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="container mx-auto py-8 px-4">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold">Economic Data Dashboard</h2>
    <a href="materials.html" class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">← Back to Materials</a>
  </div>

  <!-- Tabs Navigation -->
  <div class="border-b border-gray-200 mb-6">
    <div class="flex">
      <button id="tab-cpi" class="tab-button active">Consumer Price Index (CPI)</button>
      <button id="tab-gdp" class="tab-button">GDP</button>
      <button id="tab-unemployment" class="tab-button">Unemployment</button>
    </div>
  </div>

  <!-- CPI Tab Content -->
  <div id="content-cpi" class="tab-content active">
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Consumer Price Index (CPI) Analysis</h3>
      <p class="mb-4">Explore 12-month percentage changes in the Consumer Price Index by category since 2005. Use the controls below to customize your view.</p>
      
      <!-- Year Range Selector -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="start-year" class="block text-sm font-medium text-gray-700 mb-1">Start Year</label>
          <select id="start-year" class="w-full p-2 border border-gray-300 rounded-md">
            <!-- Will be populated by JavaScript -->
          </select>
        </div>
        <div>
          <label for="end-year" class="block text-sm font-medium text-gray-700 mb-1">End Year</label>
          <select id="end-year" class="w-full p-2 border border-gray-300 rounded-md">
            <!-- Will be populated by JavaScript -->
          </select>
        </div>
      </div>
      
      <!-- Heatmap Visualization -->
      <div class="mb-8">
        <h4 class="text-lg font-semibold mb-3">CPI Heatmap by Category</h4>
        <p class="text-sm text-gray-600 mb-4">This heatmap shows the intensity of 12-month percentage changes in CPI across different categories. Darker colors indicate higher inflation rates.</p>
        <div class="heatmap-container">
          <canvas id="cpi-heatmap" height="400"></canvas>
        </div>
      </div>
      
      <!-- Category Line Chart -->
      <div>
        <h4 class="text-lg font-semibold mb-3">CPI Trends for Selected Categories</h4>
        <p class="text-sm text-gray-600 mb-4">Select categories below to compare their inflation trends over time.</p>
        
        <!-- Category Selector -->
        <div class="category-selector mb-4" id="category-selector">
          <!-- Will be populated by JavaScript -->
        </div>
        
        <!-- Line Chart -->
        <div>
          <canvas id="cpi-line-chart" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- GDP Tab Content -->
  <div id="content-gdp" class="tab-content">
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Gross Domestic Product (GDP) Analysis</h3>
      <p class="mb-4">GDP data visualizations coming soon. This section will include interactive charts for exploring GDP growth, components, and trends.</p>
      <div class="p-12 text-center text-gray-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-lg font-medium">GDP data visualizations coming soon</p>
        <p class="mt-2">Check back later for interactive GDP charts and analysis tools</p>
      </div>
    </div>
  </div>

  <!-- Unemployment Tab Content -->
  <div id="content-unemployment" class="tab-content">
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Unemployment Data Analysis</h3>
      <p class="mb-4">Unemployment data visualizations coming soon. This section will include interactive charts for exploring unemployment rates, labor force participation, and related metrics.</p>
      <div class="p-12 text-center text-gray-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <p class="text-lg font-medium">Unemployment data visualizations coming soon</p>
        <p class="mt-2">Check back later for interactive unemployment charts and analysis tools</p>
      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="bg-gray-100 border-t mt-12 py-6 px-4">
  <div class="container mx-auto">
    <p class="text-gray-600">© 2025 Economics Department</p>
  </div>
</footer>

<!-- JavaScript for Data Visualization -->
<script>
  // Global variables
  let cpiData = [];
  let categories = [];
  let years = [];
  let months = [];
  let heatmapChart = null;
  let lineChart = null;
  let selectedCategories = ['All items', 'Food', 'Energy', 'Shelter'];

  // Initialize the page
  document.addEventListener('DOMContentLoaded', async function() {
    // Set up tab navigation
    setupTabs();
    
    // Load CPI data
    await loadCPIData();
    
    // Initialize visualizations
    initializeYearSelectors();
    initializeCategorySelector();
    createHeatmap();
    createLineChart();
    
    // Set up event listeners
    setupEventListeners();
  });

  // Set up tab navigation
  function setupTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        button.classList.add('active');
        const contentId = 'content-' + button.id.split('-')[1];
        document.getElementById(contentId).classList.add('active');
      });
    });
  }

  // Load CPI data from Excel file
  async function loadCPIData() {
    try {
      const response = await fetch('course_materials/cpi.xlsx');
      const arrayBuffer = await response.arrayBuffer();
      const data = new Uint8Array(arrayBuffer);
      const workbook = XLSX.read(data, { type: 'array' });
      
      // Get the first sheet
      const worksheet = workbook.Sheets[workbook.SheetNames[0]];
      
      // Convert to JSON
      const jsonData = XLSX.utils.sheet_to_json(worksheet);
      
      // Process the data
      cpiData = jsonData.map(row => {
        // Convert Excel date to JavaScript Date
        const date = new Date(row.Month);
        return {
          date: date,
          year: date.getFullYear(),
          month: date.getMonth(),
          ...row
        };
      });
      
      // Extract categories (column names except 'Month')
      categories = Object.keys(jsonData[0]).filter(key => key !== 'Month');
      
      // Extract unique years and months
      years = [...new Set(cpiData.map(row => row.year))].sort();
      months = [...Array(12).keys()];
      
      console.log('CPI data loaded successfully:', cpiData.length, 'rows');
    } catch (error) {
      console.error('Error loading CPI data:', error);
      alert('Failed to load CPI data. Please try refreshing the page.');
    }
  }

  // Initialize year selectors
  function initializeYearSelectors() {
    const startYearSelect = document.getElementById('start-year');
    const endYearSelect = document.getElementById('end-year');
    
    // Clear existing options
    startYearSelect.innerHTML = '';
    endYearSelect.innerHTML = '';
    
    // Add options for each year
    years.forEach(year => {
      startYearSelect.add(new Option(year, year));
      endYearSelect.add(new Option(year, year));
    });
    
    // Set default values (last 5 years)
    if (years.length > 0) {
      startYearSelect.value = years[Math.max(0, years.length - 5)];
      endYearSelect.value = years[years.length - 1];
    }
  }

  // Initialize category selector
  function initializeCategorySelector() {
    const categorySelector = document.getElementById('category-selector');
    categorySelector.innerHTML = '';
    
    // Create a button for each category
    categories.forEach(category => {
      const button = document.createElement('button');
      button.textContent = category;
      button.className = 'category-btn';
      button.dataset.category = category;
      
      // Set selected state
      if (selectedCategories.includes(category)) {
        button.classList.add('selected');
      }
      
      // Add click event
      button.addEventListener('click', () => {
        toggleCategory(category, button);
      });
      
      categorySelector.appendChild(button);
    });
  }

  // Toggle category selection
  function toggleCategory(category, button) {
    const index = selectedCategories.indexOf(category);
    
    if (index === -1) {
      // Add category if not already selected (limit to 5 categories)
      if (selectedCategories.length < 5) {
        selectedCategories.push(category);
        button.classList.add('selected');
      } else {
        alert('You can select up to 5 categories at a time.');
      }
    } else {
      // Remove category if already selected
      selectedCategories.splice(index, 1);
      button.classList.remove('selected');
    }
    
    // Update line chart
    updateLineChart();
  }

  // Create heatmap visualization
  function createHeatmap() {
    const ctx = document.getElementById('cpi-heatmap').getContext('2d');
    
    // Prepare data for heatmap
    const data = prepareHeatmapData();
    
    // Create chart
    heatmapChart = new Chart(ctx, {
      type: 'matrix',
      data: {
        datasets: [{
          label: 'CPI Heatmap',
          data: data,
          backgroundColor(context) {
            const value = context.dataset.data[context.dataIndex].v;
            const alpha = Math.min(Math.max((value + 0.05) / 0.15, 0), 1);
            return value < 0 
              ? `rgba(59, 130, 246, ${alpha})` // Blue for negative (deflation)
              : `rgba(239, 68, 68, ${alpha})`; // Red for positive (inflation)
          },
          borderWidth: 1,
          borderColor: 'rgba(255, 255, 255, 0.5)',
          width: ({ chart }) => (chart.chartArea || {}).width / categories.length - 1,
          height: ({ chart }) => (chart.chartArea || {}).height / 12 - 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          tooltip: {
            callbacks: {
              title() {
                return '';
              },
              label(context) {
                const d = context.dataset.data[context.dataIndex];
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return [
                  `Category: ${d.c}`,
                  `Date: ${monthNames[d.y]} ${d.x}`,
                  `Change: ${(d.v * 100).toFixed(1)}%`
                ];
              }
            }
          },
          legend: {
            display: false
          }
        },
        scales: {
          x: {
            type: 'category',
            labels: getFilteredYears(),
            offset: true,
            ticks: {
              maxRotation: 0
            },
            grid: {
              display: false
            }
          },
          y: {
            type: 'category',
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            offset: true,
            reverse: true,
            grid: {
              display: false
            }
          }
        }
      }
    });
  }

  // Prepare data for heatmap
  function prepareHeatmapData() {
    const startYear = parseInt(document.getElementById('start-year').value);
    const endYear = parseInt(document.getElementById('end-year').value);
    const filteredData = cpiData.filter(row => row.year >= startYear && row.year <= endYear);
    
    // Create data points for heatmap
    const data = [];
    
    filteredData.forEach(row => {
      categories.forEach(category => {
        data.push({
          x: row.year,
          y: row.month,
          v: row[category],
          c: category
        });
      });
    });
    
    return data;
  }

  // Create line chart visualization
  function createLineChart() {
    const ctx = document.getElementById('cpi-line-chart').getContext('2d');
    
    // Prepare data for line chart
    const data = prepareLineChartData();
    
    // Create chart
    lineChart = new Chart(ctx, {
      type: 'line',
      data: data,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false
        },
        plugins: {
          tooltip: {
            callbacks: {
              label(context) {
                return `${context.dataset.label}: ${(context.parsed.y * 100).toFixed(1)}%`;
              }
            }
          },
          legend: {
            position: 'top'
          }
        },
        scales: {
          x: {
            type: 'time',
            time: {
              unit: 'month',
              displayFormats: {
                month: 'MMM yyyy'
              }
            },
            title: {
              display: true,
              text: 'Date'
            }
          },
          y: {
            title: {
              display: true,
              text: '12-Month Percentage Change'
            },
            ticks: {
              callback: function(value) {
                return (value * 100).toFixed(0) + '%';
              }
            }
          }
        }
      }
    });
  }

  // Prepare data for line chart
  function prepareLineChartData() {
    const startYear = parseInt(document.getElementById('start-year').value);
    const endYear = parseInt(document.getElementById('end-year').value);
    const filteredData = cpiData.filter(row => row.year >= startYear && row.year <= endYear);
    
    // Create datasets for selected categories
    const datasets = selectedCategories.map((category, index) => {
      const colors = [
        'rgb(59, 130, 246)', // Blue
        'rgb(239, 68, 68)',  // Red
        'rgb(16, 185, 129)', // Green
        'rgb(245, 158, 11)', // Amber
        'rgb(139, 92, 246)'  // Purple
      ];
      
      return {
        label: category,
        data: filteredData.map(row => ({
          x: row.date,
          y: row[category]
        })),
        borderColor: colors[index % colors.length],
        backgroundColor: colors[index % colors.length] + '20',
        borderWidth: 2,
        tension: 0.1
      };
    });
    
    return { datasets };
  }

  // Update heatmap with new data
  function updateHeatmap() {
    if (heatmapChart) {
      heatmapChart.data.datasets[0].data = prepareHeatmapData();
      heatmapChart.options.scales.x.labels = getFilteredYears();
      heatmapChart.update();
    }
  }

  // Update line chart with new data
  function updateLineChart() {
    if (lineChart) {
      lineChart.data = prepareLineChartData();
      lineChart.update();
    }
  }

  // Get filtered years based on selection
  function getFilteredYears() {
    const startYear = parseInt(document.getElementById('start-year').value);
    const endYear = parseInt(document.getElementById('end-year').value);
    return years.filter(year => year >= startYear && year <= endYear);
  }

  // Set up event listeners
  function setupEventListeners() {
    // Year selectors
    document.getElementById('start-year').addEventListener('change', () => {
      updateHeatmap();
      updateLineChart();
    });
    
    document.getElementById('end-year').addEventListener('change', () => {
      updateHeatmap();
      updateLineChart();
    });
  }
</script>
</body>
</html>
