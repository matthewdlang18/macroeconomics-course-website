<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Market Analysis - Principles of Macroeconomics</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-700 text-white">
        <div class="container mx-auto py-6 px-4">
            <div class="flex items-center mb-2">
                <a href="index.html" class="text-blue-100 hover:text-white mr-2">← Back to Activities</a>
            </div>
            <h1 class="text-3xl font-bold">Discussion Activity 1: Housing Market Analysis</h1>
            <p class="mt-2 text-blue-100">April 1-4, 2025</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="border-b">
                <div class="flex">
                    <button id="tab-instructions" class="tab-btn px-6 py-3 font-medium border-b-2 border-blue-600 text-blue-600">Instructions</button>
                    <button id="tab-analysis" class="tab-btn px-6 py-3 font-medium border-b-2 border-transparent">Your Analysis</button>
                    <button id="tab-data" class="tab-btn px-6 py-3 font-medium border-b-2 border-transparent">Housing Data</button>
                    <button id="tab-ai" class="tab-btn px-6 py-3 font-medium border-b-2 border-transparent">AI Feedback</button>
                </div>
            </div>
            
            <!-- Tab Content -->
            <div class="p-6">
                <!-- Instructions Tab -->
                <div id="content-instructions" class="tab-content">
                    <h2 class="text-2xl font-semibold mb-4">Instructions</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-medium">Objective</h3>
                            <p>Identify whether the housing market in an area of the country is healthy or not by gathering recent data on housing metrics in a state.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium">Step 1: Choose a State</h3>
                            <p>Scan the QR code provided by your TA to access the Google Sheet and claim your state.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium">Step 2: Navigate to Redfin Data Center</h3>
                            <p>Go to <a href="https://www.redfin.com/news/data-center/" class="text-blue-600 underline" target="_blank">https://www.redfin.com/news/data-center/</a> and customize the data to show your state.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium">Step 3: Analyze Housing Metrics</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>Median Sale Price</strong> (balanced market: 3-5% growth per year)</li>
                                <li><strong>Months' Supply</strong> (balanced market: 4-6 months)</li>
                                <li><strong>Days on Market</strong> (balanced market: 30-60 days)</li>
                                <li><strong>Sale-to-List</strong> (balanced market: 98-102%)</li>
                                <li><strong>Price Drops</strong> (balanced market: 10-20%)</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium">Step 4: Fill out the Analysis Table</h3>
                            <p>Weight each metric based on importance and assign values based on market conditions.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium">Step 5: Get AI Feedback</h3>
                            <p>Download your state data and ask AI to assess the health of the housing market.</p>
                        </div>
                        
                        <button id="start-analysis-btn" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Start Analysis</button>
                    </div>
                </div>
                
                <!-- Analysis Tab (Hidden by default) -->
                <div id="content-analysis" class="tab-content hidden">
                    <h2 class="text-2xl font-semibold mb-4">Your Analysis</h2>
                    <!-- This will be populated with JavaScript -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-1">Select your state:</label>
                        <select id="state-select" class="w-full md:w-1/3 border rounded p-2">
                            <option value="">Select a state</option>
                            <option value="CA">California</option>
                            <option value="TX">Texas</option>
                            <option value="FL">Florida</option>
                            <option value="NY">New York</option>
                            <!-- Add more states -->
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-1">Upload state data (optional):</label>
                        <div class="border-2 border-dashed rounded-md p-4 flex items-center justify-center">
                            <div id="file-upload-area" class="text-center">
                                <div class="mb-2">Drag & drop files or click to browse</div>
                                <button id="upload-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Upload File</button>
                                <input type="file" id="file-input" class="hidden" accept=".xlsx,.csv,.pdf">
                            </div>
                            <div id="file-uploaded" class="hidden">
                                <span id="filename">housing_data.xlsx</span>
                                <span class="ml-2 text-green-500">✓</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analysis Table -->
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr>
                                    <th class="text-left border p-2">Housing Metric</th>
                                    <th class="text-left border p-2">Weight</th>
                                    <th class="text-left border p-2">Value</th>
                                    <th class="text-left border p-2">Weighted Value</th>
                                    <th class="text-left border p-2">Justification</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border p-2">Median Sale Price</td>
                                    <td class="border p-2">
                                        <input type="number" class="weight-input w-16 border rounded p-1" data-metric="price" value="20">
                                    </td>
                                    <td class="border p-2">
                                        <input type="number" class="value-input w-16 border rounded p-1" data-metric="price" value="50">
                                    </td>
                                    <td class="border p-2 weighted-value" data-metric="price">10.00</td>
                                    <td class="border p-2">
                                        <input type="text" class="w-full border rounded p-1" placeholder="Enter justification">
                                    </td>
                                </tr>
                                <!-- Add more rows for other metrics -->
                                <tr>
                                    <td class="border p-2">Months' Supply</td>
                                    <td class="border p-2">
                                        <input type="number" class="weight-input w-16 border rounded p-1" data-metric="supply" value="20">
                                    </td>
                                    <td class="border p-2">
                                        <input type="number" class="value-input w-16 border rounded p-1" data-metric="supply" value="50">
                                    </td>
                                    <td class="border p-2 weighted-value" data-metric="supply">10.00</td>
                                    <td class="border p-2">
                                        <input type="text" class="w-full border rounded p-1" placeholder="Enter justification">
                                    </td>
                                </tr>
                                <!-- Add remaining metrics -->
                                
                                <tr>
                                    <td class="border p-2 font-bold">Total</td>
                                    <td class="border p-2 font-bold" id="total-weight">100</td>
                                    <td class="border p-2"></td>
                                    <td class="border p-2 font-bold" id="total-weighted-value">50.00</td>
                                    <td class="border p-2"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="font-medium mb-2">Final Assessment</h3>
                        <div class="p-3 bg-gray-100 rounded" id="market-assessment">
                            The housing market in the state of <span id="selected-state">[your state]</span> is a
                            <strong id="market-type">balanced</strong> market.
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <button class="back-to-instructions bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Instructions</button>
                        <button id="get-ai-feedback" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Get AI Feedback</button>
                    </div>
                </div>
                
                <!-- Housing Data Tab (Hidden by default) -->
                <div id="content-data" class="tab-content hidden">
                    <h2 class="text-2xl font-semibold mb-4">Housing Market Data</h2>
                    <p class="mb-4">Visual representation of housing metrics for <span id="data-state">[your state]</span>.</p>
                    
                    <!-- Charts will go here -->
                    <div class="mb-6">
                        <h3 class="font-medium mb-2">Median Sale Price</h3>
                        <div class="bg-white p-4 rounded border">
                            <canvas id="priceChart" height="250"></canvas>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <h3 class="font-medium mb-2">Months' Supply</h3>
                            <div class="bg-white p-4 rounded border">
                                <canvas id="supplyChart" height="200"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-medium mb-2">Days on Market</h3>
                            <div class="bg-white p-4 rounded border">
                                <canvas id="daysChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <button class="back-to-analysis bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Back to Analysis</button>
                </div>
                
                <!-- AI Feedback Tab (Hidden by default) -->
                <div id="content-ai" class="tab-content hidden">
                    <h2 class="text-2xl font-semibold mb-4">AI Feedback</h2>
                    <p class="mb-4">Comparison of your analysis with AI assessment.</p>
                    
                    <div id="ai-loading" class="text-center py-8">
                        <p>Generating AI analysis...</p>
                        <div class="mt-4 w-12 h-12 border-t-4 border-blue-600 border-solid rounded-full animate-spin mx-auto"></div>
                    </div>
                    
                    <div id="ai-results" class="hidden">
                        <!-- AI results will go here -->
                        <div class="overflow-x-auto mb-6">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr>
                                        <th class="text-left border p-2">Housing Metric</th>
                                        <th class="text-left border p-2">Your Weight</th>
                                        <th class="text-left border p-2">Your Value</th>
                                        <th class="text-left border p-2">AI Weight</th>
                                        <th class="text-left border p-2">AI Value</th>
                                    </tr>
                                </thead>
                                <tbody id="ai-comparison-table">
                                    <!-- This will be populated with JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="font-medium mb-2">Comparison</h3>
                            <div class="p-4 bg-gray-100 rounded" id="ai-comparison-text">
                                <!-- This will be populated with JavaScript -->
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="font-medium mb-2">Discussion Questions</h3>
                            <div class="space-y-3">
                                <div>
                                    <p class="font-medium text-sm">1. Given that housing market trends can vary significantly by region, what additional regional data would have helped your group better understand the specific dynamics of your state's housing market compared to national trends?</p>
                                    <textarea class="w-full border rounded p-2 mt-1" rows="2"></textarea>
                                </div>
                                <!-- Add more questions -->
                            </div>
                        </div>
                    </div>
                    
                    <button class="back-to-analysis bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-4">Back to Analysis</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t mt-12 py-6 px-4">
        <div class="container mx-auto">
            <p class="text-gray-600">© 2025 Economics Department</p>
        </div>
    </footer>

    <!-- Basic JavaScript for tab switching and interactivity -->
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            function showTab(tabId) {
                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Remove active class from all tab buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent');
                });
                
                // Show the selected tab content
                document.getElementById('content-' + tabId).classList.remove('hidden');
                
                // Add active class to the clicked tab button
                document.getElementById('tab-' + tabId).classList.add('border-blue-600', 'text-blue-600');
                document.getElementById('tab-' + tabId).classList.remove('border-transparent');
            }
            
            // Add click event to tab buttons
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.id.replace('tab-', '');
                    showTab(tabId);
                });
            });
            
            // Start Analysis button
            document.getElementById('start-analysis-btn').addEventListener('click', function() {
                showTab('analysis');
            });
            
            // Back to Instructions button
            document.querySelectorAll('.back-to-instructions').forEach(btn => {
                btn.addEventListener('click', function() {
                    showTab('instructions');
                });
            });
            
            // Back to Analysis button
            document.querySelectorAll('.back-to-analysis').forEach(btn => {
                btn.addEventListener('click', function() {
                    showTab('analysis');
                });
            });
            
            // Get AI Feedback button
            document.getElementById('get-ai-feedback').addEventListener('click', function() {
                showTab('ai');
                // Simulate AI analysis (in a real implementation, this would call an API)
                setTimeout(function() {
                    document.getElementById('ai-loading').classList.add('hidden');
                    document.getElementById('ai-results').classList.remove('hidden');
                }, 2000);
            });
            
            // File upload handling
            document.getElementById('upload-btn').addEventListener('click', function() {
                document.getElementById('file-input').click();
            });
            
            document.getElementById('file-input').addEventListener('change', function() {
                if (this.files.length > 0) {
                    document.getElementById('file-upload-area').classList.add('hidden');
                    document.getElementById('file-uploaded').classList.remove('hidden');
                    document.getElementById('filename').textContent = this.files[0].name;
                }
            });
            
            // State selection handling
            document.getElementById('state-select').addEventListener('change', function() {
                const state = this.value;
                if (state) {
                    document.getElementById('selected-state').textContent = this.options[this.selectedIndex].text;
                    document.getElementById('data-state').textContent = this.options[this.selectedIndex].text;
                    // In a real implementation, this would load actual data for the selected state
                    initCharts(); // Reinitialize charts with state data
                }
            });
            
            // Initialize charts with sample data
            function initCharts() {
                // Sample data
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                
                // Median Sale Price Chart
                const priceCtx = document.getElementById('priceChart').getContext('2d');
                new Chart(priceCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Median Sale Price ($)',
                            data: [350000, 355000, 360000, 365000, 370000, 380000],
                            borderColor: 'rgb(79, 70, 229)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                // Months' Supply Chart
                const supplyCtx = document.getElementById('supplyChart').getContext('2d');
                new Chart(supplyCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Months\' Supply',
                            data: [3.2, 3.0, 2.8, 2.5, 2.2, 2.0],
                            borderColor: 'rgb(16, 185, 129)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                // Days on Market Chart
                const daysCtx = document.getElementById('daysChart').getContext('2d');
                new Chart(daysCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Days on Market',
                            data: [25, 23, 20, 18, 15, 14],
                            borderColor: 'rgb(245, 158, 11)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Calculate weighted values when inputs change
            const weightInputs = document.querySelectorAll('.weight-input');
            const valueInputs = document.querySelectorAll('.value-input');
            
            function updateWeightedValues() {
                let totalWeight = 0;
                let totalWeightedValue = 0;
                
                weightInputs.forEach(input => {
                    const metric = input.dataset.metric;
                    const weight = parseFloat(input.value) || 0;
                    const valueInput = document.querySelector(`.value-input[data-metric="${metric}"]`);
                    const value = parseFloat(valueInput.value) || 0;
                    const weightedValue = (weight / 100) * value;
                    
                    document.querySelector(`.weighted-value[data-metric="${metric}"]`).textContent = weightedValue.toFixed(2);
                    
                    totalWeight += weight;
                    totalWeightedValue += weightedValue;
                });
                
                // Update totals
                document.getElementById('total-weight').textContent = totalWeight;
                document.getElementById('total-weighted-value').textContent = totalWeightedValue.toFixed(2);
                
                // Color the total weight based on whether it sums to 100
                if (totalWeight === 100) {
                    document.getElementById('total-weight').classList.add('text-green-600');
                    document.getElementById('total-weight').classList.remove('text-red-600');
                } else {
                    document.getElementById('total-weight').classList.add('text-red-600');
                    document.getElementById('total-weight').classList.remove('text-green-600');
                }
                
                // Update market assessment
                const marketType = document.getElementById('market-type');
                if (totalWeightedValue < 40) {
                    marketType.textContent = 'buyers';
                } else if (totalWeightedValue > 60) {
                    marketType.textContent = 'sellers';
                } else {
                    marketType.textContent = 'balanced';
                }
            }
            
            // Add input event listeners
            weightInputs.forEach(input => {
                input.addEventListener('input', updateWeightedValues);
            });
            
            valueInputs.forEach(input => {
                input.addEventListener('input', updateWeightedValues);
            });
            
            // Initialize charts and calculations
            initCharts();
            updateWeightedValues();
            
            // Set up sample AI comparison data
            function setupAIComparison() {
                // This would normally come from an AI API
                const aiData = {
                    price: { weight: 25, value: 65 },
                    supply: { weight: 20, value: 70 },
                    days: { weight: 15, value: 60 },
                    saleToList: { weight: 25, value: 55 },
                    priceDrops: { weight: 15, value: 40 }
                };
                
                const metrics = {
                    price: 'Median Sale Price',
                    supply: 'Months\' Supply',
                    days: 'Days on Market',
                    saleToList: 'Sale-to-List',
                    priceDrops: 'Price Drops'
                };
                
                let tableHTML = '';
                let aiTotalWeightedValue = 0;
                
                // Create comparison table rows
                Object.keys(aiData).forEach(metric => {
                    const userWeight = parseFloat(document.querySelector(`.weight-input[data-metric="${metric}"]`).value) || 0;
                    const userValue = parseFloat(document.querySelector(`.value-input[data-metric="${metric}"]`).value) || 0;
                    const aiWeight = aiData[metric].weight;
                    const aiValue = aiData[metric].value;
                    
                    aiTotalWeightedValue += (aiWeight / 100) * aiValue;
                    
                    tableHTML += `
                        <tr>
                            <td class="border p-2">${metrics[metric]}</td>
                            <td class="border p-2">${userWeight}</td>
                            <td class="border p-2">${userValue}</td>
                            <td class="border p-2">${aiWeight}</td>
                            <td class="border p-2">${aiValue}</td>
                        </tr>
                    `;
                });
                
                // Add total row
                const userTotalWeightedValue = parseFloat(document.getElementById('total-weighted-value').textContent);
                tableHTML += `
                    <tr>
                        <td class="border p-2 font-bold">Total Weighted Value</td>
                        <td class="border p-2" colspan="2">${userTotalWeightedValue.toFixed(2)}</td>
                        <td class="border p-2" colspan="2">${aiTotalWeightedValue.toFixed(2)}</td>
                    </tr>
                `;
                
                document.getElementById('ai-comparison-table').innerHTML = tableHTML;
                
                // Set up comparison text
                const userMarketType = userTotalWeightedValue < 40 ? 'buyers' : userTotalWeightedValue > 60 ? 'sellers' : 'balanced';
                const aiMarketType = aiTotalWeightedValue < 40 ? 'buyers' : aiTotalWeightedValue > 60 ? 'sellers' : 'balanced';
                
                const comparisonText = `
                    <p>Your analysis rates the housing market in ${document.getElementById('selected-state').textContent} as a <strong>${userMarketType}</strong> market with a score of ${userTotalWeightedValue.toFixed(2)}.</p>
                    <p class="mt-2">The AI rates it as a <strong>${aiMarketType}</strong> market with a score of ${aiTotalWeightedValue.toFixed(2)}.</p>
                    <p class="mt-2">The main differences in your analyses are:</p>
                    <ul class="list-disc pl-5 mt-1">
                        <li>AI places more emphasis on median sale price and sale-to-list ratio</li>
                        <li>AI rates the months' supply as more favorable to sellers</li>
                        <li>You both agree that price drops indicate a more balanced market</li>
                    </ul>
                `;
                
                document.getElementById('ai-comparison-text').innerHTML = comparisonText;
            }
            
            // Set up AI comparison when the AI tab is shown
            document.getElementById('tab-ai').addEventListener('click', function() {
                setTimeout(function() {
                    setupAIComparison();
                }, 2000);
            });
        });
    </script>
</body>
</html>