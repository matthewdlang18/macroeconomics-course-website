<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Market Analysis - Principles of Macroeconomics</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel file handling -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-700 text-white">
        <div class="container mx-auto py-6 px-4">
            <div class="flex items-center mb-2">
                <a href="../index.html" class="text-blue-100 hover:text-white mr-2">← Back to Course Home</a>
                <a href="index.html" class="text-blue-100 hover:text-white ml-4">← Back to Activities</a>
            </div>
            <h1 class="text-3xl font-bold">Discussion Activity 1: Housing Market Analysis</h1>
            <p class="mt-2 text-blue-100">April 1-4, 2025</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <!-- Step Navigation -->
        <div class="flex mb-8 border-b">
            <button id="nav-instructions" class="step-nav font-medium px-4 py-2 border-b-2 border-blue-600 text-blue-600">1. Instructions</button>
            <button id="nav-upload" class="step-nav font-medium px-4 py-2 border-b-2 border-transparent text-gray-500">2. Upload Data</button>
            <button id="nav-analysis" class="step-nav font-medium px-4 py-2 border-b-2 border-transparent text-gray-500">3. Analysis</button>
        </div>

        <!-- Steps Content -->
        <div id="step-instructions" class="step-content">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-4">Activity Instructions</h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-medium">Objective</h3>
                        <p style="margin-bottom: 20px;">In this activity, you and your group (of 2 to 3) will identify whether the housing market in a U.S. state is healthy or not by analyzing recent housing metrics data.</p>
                        <p>After you form your group, claim your state on the Google Sheet provided by your TA.</p>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium">Housing Market Metrics</h3>
                        <p class="mb-2">You'll analyze these five key metrics to determine market health:</p>
                        <div class="mt-3 space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium">Median Sale Price</h4>
                                <p>The middle value of all home sale prices for a given period.</p>
                                <p class="mt-1 italic text-sm">A balanced market has 3-5% growth in prices per year.</p>
                            </div>
                            
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium">Months' Supply (Months of Inventory)</h4>
                                <p>Number of months it would take to sell all the homes on the market, given the current pace of sales.</p>
                                <p class="mt-1 italic text-sm">A balanced market has 4-6 months of supply.</p>
                            </div>
                            
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <h4 class="font-medium">Days on Market</h4>
                                <p>The average number of days a home is listed for sale before it goes under contract (sold).</p>
                                <p class="mt-1 italic text-sm">In a balanced market, homes usually sell within 30-60 days.</p>
                            </div>
                            
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-medium">Sale-to-List</h4>
                                <p>A measure of how close the sale price is to the asking price set by the seller. Specifically (Sale Price/List Price) × 100.</p>
                                <p class="mt-1 italic text-sm">A sale-to-list price ratio between 98% to 102% is consistent with a balanced market.</p>
                            </div>
                            
                            <div class="p-4 bg-red-50 rounded-lg">
                                <h4 class="font-medium">Price Drops</h4>
                                <p>The percentage of active home listings in a market that have had at least one price reduction from their original list price.</p>
                                <p class="mt-1 italic text-sm">In a balanced market, price drops range between 10% and 20%.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium">Accessing Housing Data</h3>
                        <p class="mb-2">To gather data for your assigned state, follow these steps:</p>
                        <ol class="list-decimal pl-5 space-y-2">
                            <li>Your TA will show a QR code that links to a Google Sheet</li>
                            <li>Claim your state by entering your group name next to the state (first come, first served)</li>
                            <li>Go to the <a href="https://www.redfin.com/news/data-center/" class="text-blue-600 underline" target="_blank">Redfin Data Center</a></li>
                            <li>Find the "Redfin Monthly Housing Market Data" section</li>
                            <li>Remove metro areas by clicking "Region Type" and unchecking "County", "Metro", and "Place/City"</li>
                            <li>Keep "National" and "State" checked</li>
                            <li>Click on "Region" and select your assigned state</li>
                            <li>Click "Apply" to see the data</li>
                            <li>Click on the "Download" button and the raw data will appear</li>
                            <li>Click the download button, then "Crosstab" button, and choose Excel</li>
                            <li>Save the file to upload in the next step of this activity</li>
                        </ol>
                    </div>
                    
                    <div class="flex justify-end">
                        <button id="next-upload" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Next: Upload Your Data</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="step-upload" class="step-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-4">Upload Your Housing Data</h2>
                
                <p class="mb-4">Upload the housing data Excel file you downloaded from Redfin for your state.</p>
                
                <div class="p-4 bg-yellow-50 rounded-lg mb-6">
                    <h3 class="font-medium">Data Upload Instructions:</h3>
                    <ol class="list-decimal pl-5 space-y-1 mt-2">
                        <li>Make sure you've downloaded the Excel file (.xlsx) from Redfin Data Center</li>
                        <li>Click the "Upload File" button below to select your file</li>
                        <li>Once uploaded, we will generate visualizations to help with your analysis</li>
                    </ol>
                </div>
                
                <div class="border-2 border-dashed rounded-md p-6 flex flex-col items-center justify-center mb-6">
                    <div id="upload-area" class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-gray-500 mb-3">Drag & drop your Excel file here or click to browse</p>
                        <button id="upload-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Upload File</button>
                        <input type="file" id="file-input" class="hidden" accept=".xlsx,.xls">
                    </div>
                    <div id="file-uploaded" class="hidden">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span id="filename" class="text-green-700 font-medium">housing_data.xlsx</span>
                            <button id="remove-file" class="ml-3 text-red-500 text-sm underline">Remove</button>
                        </div>
                        <div class="text-gray-700 mt-2">
                            <p id="file-stats">File loaded successfully. Click "Next" to proceed to analysis.</p>
                        </div>
                    </div>
                </div>
                
                <div id="data-preview" class="hidden">
                    <h3 class="font-medium mb-3">Data Preview</h3>
                    <div class="overflow-x-auto mb-4">
                        <table id="preview-table" class="min-w-full border border-gray-300">
                            <thead>
                                <tr class="bg-gray-100">
                                    <!-- Table headers will be inserted here -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Table rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                    <p class="text-sm text-gray-600">Showing preview of data that will be used for analysis.</p>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button id="back-to-instructions" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Instructions</button>
                    <button id="next-to-analysis" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700" disabled>Next: Analyze Data</button>
                </div>
            </div>
        </div>
        
        <div id="step-analysis" class="step-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-4">Housing Market Analysis</h2>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h3 class="font-medium">How to Complete the Analysis:</h3>
                    <ol class="list-decimal pl-5 space-y-1 mt-2">
                        <li><strong>Weight</strong>: Assign a weight to each metric based on importance (weights must sum to 100)
                            <ul class="list-disc pl-5 mt-1 text-sm">
                                <li>If all metrics are equally important: 20 per metric</li>
                                <li>If one metric matters more, give it a higher weight</li>
                            </ul>
                        </li>
                        <li><strong>Value</strong>: Assign a value from 1-100 for each metric:
                            <ul class="list-disc pl-5 mt-1 text-sm">
                                <li>Below 50: Market favors buyers</li>
                                <li>Above 50: Market favors sellers</li>
                                <li>Around 50: Balanced market</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="mb-6">
                    <label for="time-range" class="mr-2 text-sm">Data Time Range:</label>
                    <select id="time-range" class="border rounded p-1 text-sm">
                        <option value="12">Last 12 months</option>
                        <option value="24">Last 24 months</option>
                        <option value="60" selected>Last 5 years</option>
                        <option value="all">All data</option>
                    </select>
                </div>
                
                <div class="space-y-6">
                    <!-- Median Sale Price -->
                    <div class="bg-white p-4 border rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Median Sale Price</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <!-- Metric Input -->
                            <div>
                                <div class="border p-4 rounded-lg bg-blue-50">
                                    <p class="text-sm mb-2">Balanced: 3-5% growth/year</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Weight:</label>
                                            <input type="number" class="weight-input w-full text-center border rounded p-1" data-metric="price" min="0" max="100" step="1" value="20">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Value:</label>
                                            <input type="number" class="value-input w-full text-center border rounded p-1" data-metric="price" min="1" max="100" step="1" value="50">
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm">Weighted Value: <span class="font-medium weighted-value" data-metric="price">10.00</span></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Chart -->
                            <div>
                                <div style="height: 180px;">
                                    <canvas id="priceChart"></canvas>
                                </div>
                                <div class="mt-2 text-xs text-gray-600">
                                    <p><span class="font-medium">Current Value:</span> $<span id="price-value">350,000</span></p>
                                    <p><span class="font-medium">Annual Growth:</span> <span id="price-growth">5.2%</span> (Balanced: 3-5%)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Months' Supply -->
                    <div class="bg-white p-4 border rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Months' Supply</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <!-- Metric Input -->
                            <div>
                                <div class="border p-4 rounded-lg bg-green-50">
                                    <p class="text-sm mb-2">Balanced: 4-6 months</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Weight:</label>
                                            <input type="number" class="weight-input w-full text-center border rounded p-1" data-metric="supply" min="0" max="100" step="1" value="20">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Value:</label>
                                            <input type="number" class="value-input w-full text-center border rounded p-1" data-metric="supply" min="1" max="100" step="1" value="50">
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm">Weighted Value: <span class="font-medium weighted-value" data-metric="supply">10.00</span></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Chart -->
                            <div>
                                <div style="height: 180px;">
                                    <canvas id="supplyChart"></canvas>
                                </div>
                                <div class="mt-2 text-xs text-gray-600">
                                    <p><span class="font-medium">Current:</span> <span id="supply-value">2.1</span> months</p>
                                    <p><span class="font-medium">Balanced:</span> 4-6 months</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Days on Market -->
                    <div class="bg-white p-4 border rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Days on Market</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <!-- Metric Input -->
                            <div>
                                <div class="border p-4 rounded-lg bg-yellow-50">
                                    <p class="text-sm mb-2">Balanced: 30-60 days</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Weight:</label>
                                            <input type="number" class="weight-input w-full text-center border rounded p-1" data-metric="days" min="0" max="100" step="1" value="20">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Value:</label>
                                            <input type="number" class="value-input w-full text-center border rounded p-1" data-metric="days" min="1" max="100" step="1" value="50">
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm">Weighted Value: <span class="font-medium weighted-value" data-metric="days">10.00</span></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Chart -->
                            <div>
                                <div style="height: 180px;">
                                    <canvas id="daysChart"></canvas>
                                </div>
                                <div class="mt-2 text-xs text-gray-600">
                                    <p><span class="font-medium">Current:</span> <span id="days-value">15</span> days</p>
                                    <p><span class="font-medium">Balanced:</span> 30-60 days</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sale-to-List -->
                    <div class="bg-white p-4 border rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Sale-to-List Ratio</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <!-- Metric Input -->
                            <div>
                                <div class="border p-4 rounded-lg bg-purple-50">
                                    <p class="text-sm mb-2">Balanced: 98-102%</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Weight:</label>
                                            <input type="number" class="weight-input w-full text-center border rounded p-1" data-metric="saleToList" min="0" max="100" step="1" value="20">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Value:</label>
                                            <input type="number" class="value-input w-full text-center border rounded p-1" data-metric="saleToList" min="1" max="100" step="1" value="50">
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm">Weighted Value: <span class="font-medium weighted-value" data-metric="saleToList">10.00</span></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Chart -->
                            <div>
                                <div style="height: 180px;">
                                    <canvas id="saleToListChart"></canvas>
                                </div>
                                <div class="mt-2 text-xs text-gray-600">
                                    <p><span class="font-medium">Current:</span> <span id="sale-to-list-value">101.5%</span></p>
                                    <p><span class="font-medium">Balanced:</span> 98-102%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Price Drops -->
                    <div class="bg-white p-4 border rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Price Drops</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <!-- Metric Input -->
                            <div>
                                <div class="border p-4 rounded-lg bg-red-50">
                                    <p class="text-sm mb-2">Balanced: 10-20%</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Weight:</label>
                                            <input type="number" class="weight-input w-full text-center border rounded p-1" data-metric="priceDrops" min="0" max="100" step="1" value="20">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Value:</label>
                                            <input type="number" class="value-input w-full text-center border rounded p-1" data-metric="priceDrops" min="1" max="100" step="1" value="50">
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm">Weighted Value: <span class="font-medium weighted-value" data-metric="priceDrops">10.00</span></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Chart -->
                            <div>
                                <div style="height: 180px;">
                                    <canvas id="priceDropsChart"></canvas>
                                </div>
                                <div class="mt-2 text-xs text-gray-600">
                                    <p><span class="font-medium">Current:</span> <span id="price-drops-value">7%</span></p>
                                    <p><span class="font-medium">Balanced:</span> 10-20%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Final Assessment Section -->
                    <div class="bg-white p-4 border rounded-lg">
                        <div id="weight-warning" class="hidden text-red-600 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            Weights must sum to 100. Please adjust your weights.
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Totals -->
                            <div>
                                <h3 class="text-lg font-medium mb-3">Total Analysis</h3>
                                <table class="w-full border-collapse">
                                    <tr>
                                        <td class="border p-2 font-medium">Total Weight:</td>
                                        <td class="border p-2 font-bold text-center" id="total-weight">100</td>
                                    </tr>
                                    <tr>
                                        <td class="border p-2 font-medium">Final Score:</td>
                                        <td class="border p-2 font-bold text-center" id="total-weighted-value">50.00</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Market Assessment -->
                            <div>
                                <h3 class="text-lg font-medium mb-3">Your Market Assessment:</h3>
                                <div class="p-4 border rounded-lg">
                                    <p class="text-lg mb-3">
                                        The housing market is a 
                                        <span id="market-type" class="font-bold">balanced</span> market with a score of 
                                        <span id="final-score" class="font-bold">50.00</span>.
                                    </p>
                                    <div class="relative pt-1">
                                        <div class="overflow-hidden h-6 text-xs flex rounded bg-gray-200">
                                            <div class="w-1/3 bg-blue-300 rounded-l"></div>
                                            <div class="w-1/3 bg-green-300"></div>
                                            <div class="w-1/3 bg-red-300 rounded-r"></div>
                                            <div id="score-marker" class="absolute h-full w-1 bg-black" style="left: 50%"></div>
                                        </div>
                                        <div class="flex justify-between text-xs mt-1">
                                            <span>0 - Buyers</span>
                                            <span>40</span>
                                            <span>60</span>
                                            <span>Sellers - 100</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="justification" class="block text-gray-700 mb-1 font-medium">Overall Justification:</label>
                            <textarea id="justification" class="w-full border rounded p-2" rows="3" placeholder="Briefly explain your overall assessment of this state's housing market..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg mt-6">
                    <p><strong>Important:</strong> After completing your analysis, one member of your group should enter your values in the Google Sheet provided by your TA. Your TA will use this data to create visual maps showing market assessments across all states.</p>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button id="back-to-upload" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Data Upload</button>
                    <div class="flex space-x-3">
                        <a href="../dashboard/" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
                            </svg>
                            Dashboard
                        </a>
                        <button id="finish-activity" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Finish Activity</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Completion Modal (Hidden by default) -->
        <div id="completion-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full">
                <h2 class="text-2xl font-bold mb-4">Activity Completed!</h2>
                <p class="mb-4">You have successfully completed the Housing Market Analysis activity.</p>
                <p class="mb-6">Your final assessment: The housing market is a <span id="modal-market-type" class="font-bold">balanced</span> market with a score of <span id="modal-score" class="font-bold">50.00</span>.</p>
                <div class="p-4 bg-yellow-50 rounded-lg mb-4">
                    <p><strong>Next Steps:</strong></p>
                    <ol class="list-decimal pl-5 mt-1">
                        <li>One group member should enter your values in the TA's Google Sheet</li>
                        <li>Your TA will create visual maps showing all states' market assessments</li>
                        <li>Prepare to discuss your analysis with the class</li>
                    </ol>
                </div>
                <div class="flex justify-end space-x-3">
                    <a href="../dashboard/" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">View Dashboard</a>
                    <button id="close-modal" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Return to Activities</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t mt-12 py-6 px-4">
        <div class="container mx-auto">
            <p class="text-gray-600">© 2025 Economics Department</p>
        </div>
    </footer>

    <!-- JavaScript for functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Step navigation
            const navButtons = document.querySelectorAll('.step-nav');
            const stepContents = document.querySelectorAll('.step-content');
            
            function showStep(stepId) {
                // Hide all step contents
                stepContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Remove active class from all nav buttons
                navButtons.forEach(btn => {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                
                // Show the selected step content
                document.getElementById('step-' + stepId).classList.remove('hidden');
                
                // Add active class to the clicked nav button
                document.getElementById('nav-' + stepId).classList.add('border-blue-600', 'text-blue-600');
                document.getElementById('nav-' + stepId).classList.remove('border-transparent', 'text-gray-500');
            }
            
            // Add click event to nav buttons
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const stepId = this.id.replace('nav-', '');
                    showStep(stepId);
                });
            });
            
            // Navigation button events
            document.getElementById('next-upload').addEventListener('click', function() {
                showStep('upload');
            });
            
            document.getElementById('back-to-instructions').addEventListener('click', function() {
                showStep('instructions');
            });
            
            document.getElementById('next-to-analysis').addEventListener('click', function() {
                showStep('analysis');
                initCharts(); // Initialize charts when showing the analysis step
            });
            
            document.getElementById('back-to-upload').addEventListener('click', function() {
                showStep('upload');
            });
            
            document.getElementById('finish-activity').addEventListener('click', function() {
                document.getElementById('completion-modal').classList.remove('hidden');
            });
            
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('completion-modal').classList.add('hidden');
                window.location.href = 'index.html';
            });
            
            // File upload handling
            let housingData = null;
            
            document.getElementById('upload-btn').addEventListener('click', function() {
                document.getElementById('file-input').click();
            });
            
            document.getElementById('file-input').addEventListener('change', async function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    try {
                        // Display file as uploaded
                        document.getElementById('upload-area').classList.add('hidden');
                        document.getElementById('file-uploaded').classList.remove('hidden');
                        document.getElementById('filename').textContent = file.name;
                        document.getElementById('file-stats').textContent = 'Loading data...';
                        
                        // Read the file
                        const arrayBuffer = await file.arrayBuffer();
                        const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: 'array' });
                        
                        // Get the first sheet
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        housingData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        // Update file stats
                        document.getElementById('file-stats').textContent = 
                            `File loaded successfully: ${housingData.length} rows of data. Click "Next" to analyze the data.`;
                        
                        // Show data preview
                        document.getElementById('data-preview').classList.remove('hidden');
                        createDataPreview(housingData);
                        
                        // Enable the next button
                        document.getElementById('next-to-analysis').disabled = false;
                        
                    } catch (error) {
                        console.error('Error processing file:', error);
                        document.getElementById('file-stats').textContent = 
                            'Error processing file. Please make sure it is a valid Excel file from Redfin.';
                    }
                }
            });
            
            document.getElementById('remove-file').addEventListener('click', function() {
                document.getElementById('file-input').value = '';
                document.getElementById('upload-area').classList.remove('hidden');
                document.getElementById('file-uploaded').classList.add('hidden');
                document.getElementById('data-preview').classList.add('hidden');
                housingData = null;
                document.getElementById('next-to-analysis').disabled = true;
            });
            
            // Create data preview table
            function createDataPreview(data) {
                if (!data || data.length === 0) return;
                
                const previewTable = document.getElementById('preview-table');
                const headerRow = previewTable.querySelector('thead tr');
                const tbody = previewTable.querySelector('tbody');
                
                // Clear existing table
                headerRow.innerHTML = '';
                tbody.innerHTML = '';
                
                // Get the column names from the first row
                const columns = Object.keys(data[0]);
                
                // Add headers
                columns.forEach(column => {
                    const th = document.createElement('th');
                    th.textContent = column;
                    th.className = 'p-2 border text-left';
                    headerRow.appendChild(th);
                });
                
                // Add rows (just first 3 for preview)
                for (let i = 0; i < Math.min(3, data.length); i++) {
                    const tr = document.createElement('tr');
                    columns.forEach(column => {
                        const td = document.createElement('td');
                        td.textContent = data[i][column];
                        td.className = 'p-2 border';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                }
            }
            
            // Analysis calculations
            const weightInputs = document.querySelectorAll('.weight-input');
            const valueInputs = document.querySelectorAll('.value-input');
            
            // Add validation for weight and value inputs
            weightInputs.forEach(input => {
                input.addEventListener('change', function() {
                    // Enforce min and max values
                    const min = parseInt(this.min) || 0;
                    const max = parseInt(this.max) || 100;
                    
                    if (this.value === '' || isNaN(this.value)) {
                        this.value = 0;
                    } else {
                        const value = parseInt(this.value);
                        if (value < min) this.value = min;
                        if (value > max) this.value = max;
                    }
                    
                    updateWeightedValues();
                });
            });

            valueInputs.forEach(input => {
                input.addEventListener('change', function() {
                    // Enforce min and max values
                    const min = parseInt(this.min) || 1;
                    const max = parseInt(this.max) || 100;
                    
                    if (this.value === '' || isNaN(this.value)) {
                        this.value = min;
                    } else {
                        const value = parseInt(this.value);
                        if (value < min) this.value = min;
                        if (value > max) this.value = max;
                    }
                    
                    updateWeightedValues();
                });
            });
            
            function updateWeightedValues() {
                let totalWeight = 0;
                let totalWeightedValue = 0;
                
                weightInputs.forEach(input => {
                    const metric = input.dataset.metric;
                    // Enforce min/max values during calculation
                    let weight = parseFloat(input.value) || 0;
                    weight = Math.max(0, Math.min(100, weight)); // Ensure weight is between 0-100
                    
                    const valueInput = document.querySelector(`.value-input[data-metric="${metric}"]`);
                    let value = parseFloat(valueInput.value) || 0;
                    value = Math.max(1, Math.min(100, value)); // Ensure value is between 1-100
                    
                    const weightedValue = (weight / 100) * value;
                    
                    // Update all weighted value displays for this metric
                    document.querySelectorAll(`.weighted-value[data-metric="${metric}"]`).forEach(el => {
                        el.textContent = weightedValue.toFixed(2);
                    });
                    
                    totalWeight += weight;
                    totalWeightedValue += weightedValue;
                });
                
                // Update totals
                document.getElementById('total-weight').textContent = totalWeight;
                document.getElementById('total-weighted-value').textContent = totalWeightedValue.toFixed(2);
                document.getElementById('final-score').textContent = totalWeightedValue.toFixed(2);
                document.getElementById('modal-score').textContent = totalWeightedValue.toFixed(2);
                
                // Update score marker position (0-100%)
                document.getElementById('score-marker').style.left = `${totalWeightedValue}%`;
                
                // Show/hide weight warning
                if (totalWeight !== 100) {
                    document.getElementById('weight-warning').classList.remove('hidden');
                } else {
                    document.getElementById('weight-warning').classList.add('hidden');
                }
                
                // Update market type
                const marketType = totalWeightedValue < 40 ? 'buyers' : totalWeightedValue > 60 ? 'sellers' : 'balanced';
                document.getElementById('market-type').textContent = marketType;
                document.getElementById('modal-market-type').textContent = marketType;
            }
            
            // Initialize charts
            let priceChart, supplyChart, daysChart, saleToListChart, priceDropsChart;
            let selectedState = '';
            let timeRangeMonths = 60; // Default time range (5 years)
            
            function initCharts() {
                const timeRangeSelect = document.getElementById('time-range');
                timeRangeMonths = parseInt(timeRangeSelect.value);
                
                // If we have data, process it
                if (housingData) {
                    processHousingData();
                } else {
                    // Otherwise use sample data
                    useSampleData();
                }
                
                // Add event listener for time range changes
                timeRangeSelect.addEventListener('change', function() {
                    timeRangeMonths = parseInt(this.value);
                    if (housingData) {
                        processHousingData();
                    } else {
                        useSampleData();
                    }
                });
            }
            
            function processHousingData() {
                try {
                    // Try to determine state from file data
                    if (housingData.length > 0 && housingData[0].hasOwnProperty('Region')) {
                        selectedState = housingData[0].Region;
                    }
                    
                    // Filter data for the selected state
                    let stateData = housingData.filter(row => 
                        row.Region === selectedState || 
                        // Some files might not have Region column if already filtered
                        (housingData.length > 0 && !housingData[0].hasOwnProperty('Region'))
                    );
                    
                    // If no data for selected state, use all data (assuming file was pre-filtered)
                    if (stateData.length === 0) {
                        stateData = housingData;
                    }
                    
                    // Sort by date
                    stateData.sort((a, b) => {
                        const dateA = new Date(a['Month of Period End']);
                        const dateB = new Date(b['Month of Period End']);
                        return dateA - dateB;
                    });
                    
                    // Limit data based on time range
                    if (timeRangeMonths !== 'all' && stateData.length > timeRangeMonths) {
                        stateData = stateData.slice(-timeRangeMonths);
                    }
                    
                    // Extract data for charts
                    const dates = stateData.map(row => row['Month of Period End']);
                    const prices = stateData.map(row => row['Median Sale Price']);
                    const daysOnMarket = stateData.map(row => row['Days on Market']);
                    const saleToList = stateData.map(row => 
                        row['Average Sale To List'] ? row['Average Sale To List'] * 100 : null
                    );
                    
                    // Calculate months supply (inventory/sales)
                    const monthsSupply = stateData.map(row => {
                        if (row['Homes Sold'] && row['Inventory']) {
                            return row['Inventory'] / row['Homes Sold'];
                        }
                        return null;
                    });
                    
                    // Estimate price drops (using new listings and inventory as a proxy)
                    const priceDrops = stateData.map(row => {
                        // This is a rough estimate - in a real app you'd use actual price drop data
                        if (row['New Listings'] && row['Inventory']) {
                            const ratio = 1 - (row['New Listings'] / (row['Inventory'] || 1));
                            return Math.max(0, Math.min(30, ratio * 100)); // Scale to reasonable range 0-30%
                        }
                        return null;
                    });
                    
                    // Update chart displays
                    updateMedianPriceChart(dates, prices);
                    updateMonthsSupplyChart(dates, monthsSupply);
                    updateDaysOnMarketChart(dates, daysOnMarket);
                    updateSaleToListChart(dates, saleToList);
                    updatePriceDropsChart(dates, priceDrops);
                    
                    // Update current value displays
                    if (stateData.length > 0) {
                        const latestData = stateData[stateData.length - 1];
                        
                        // Format price with commas
                        const formatter = new Intl.NumberFormat('en-US');
                        document.getElementById('price-value').textContent = formatter.format(latestData['Median Sale Price']);
                        
                        // Calculate annual price growth
                        let annualGrowth = 0;
                        if (stateData.length > 12) {
                            const currentPrice = latestData['Median Sale Price'];
                            const yearAgoPrice = stateData[stateData.length - 13]['Median Sale Price'];
                            annualGrowth = ((currentPrice / yearAgoPrice) - 1) * 100;
                            document.getElementById('price-growth').textContent = annualGrowth.toFixed(1) + '%';
                        }
                        
                        document.getElementById('days-value').textContent = latestData['Days on Market'];
                        
                        if (latestData['Average Sale To List']) {
                            document.getElementById('sale-to-list-value').textContent = (latestData['Average Sale To List'] * 100).toFixed(1) + '%';
                        }
                        
                        // Calculate and display months supply
                        if (latestData['Homes Sold'] && latestData['Inventory']) {
                            const latestMonthsSupply = latestData['Inventory'] / latestData['Homes Sold'];
                            document.getElementById('supply-value').textContent = latestMonthsSupply.toFixed(1);
                        }
                        
                        // Estimate price drops
                        if (latestData['New Listings'] && latestData['Inventory']) {
                            const latestPriceDrops = Math.max(0, Math.min(30, (1 - (latestData['New Listings'] / latestData['Inventory'])) * 100));
                            document.getElementById('price-drops-value').textContent = latestPriceDrops.toFixed(1) + '%';
                        }
                    }
                    
                } catch (error) {
                    console.error('Error updating charts:', error);
                    useSampleData();
                }
            }
            
            function updateMedianPriceChart(dates, prices) {
                const ctx = document.getElementById('priceChart').getContext('2d');
                
                // Clear any existing chart
                if (priceChart) {
                    priceChart.destroy();
                }
                
                // Create balanced market reference lines
                const balancedGrowthMin = []; // 3% growth line
                const balancedGrowthMax = []; // 5% growth line
                
                if (prices.length > 0) {
                    // Use the first price as the starting point
                    const startPrice = prices[0];
                    for (let i = 0; i < dates.length; i++) {
                        // Calculate 3% annual growth (0.25% monthly compound)
                        balancedGrowthMin.push(startPrice * Math.pow(1.0025, i));
                        // Calculate 5% annual growth (0.4% monthly compound)
                        balancedGrowthMax.push(startPrice * Math.pow(1.004, i));
                    }
                }
                
                // Create new chart
                priceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: `Median Sale Price ($)`,
                            data: prices,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: 'Balanced Min (3% Growth)',
                            data: balancedGrowthMin,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Balanced Max (5% Growth)',
                            data: balancedGrowthMax,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
            
            function updateMonthsSupplyChart(dates, monthsSupply) {
                const ctx = document.getElementById('supplyChart').getContext('2d');
                
                // Clear any existing chart
                if (supplyChart) {
                    supplyChart.destroy();
                }
                
                // Create balanced market reference lines
                const balancedMin = Array(dates.length).fill(4);
                const balancedMax = Array(dates.length).fill(6);
                
                // Create new chart
                supplyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: `Months of Supply`,
                            data: monthsSupply,
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.1
                        },
                        {
                            label: 'Balanced Min',
                            data: balancedMin,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Balanced Max',
                            data: balancedMax,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            function updateDaysOnMarketChart(dates, daysOnMarket) {
                const ctx = document.getElementById('daysChart').getContext('2d');
                
                // Clear any existing chart
                if (daysChart) {
                    daysChart.destroy();
                }
                
                // Create balanced market reference lines
                const balancedMin = Array(dates.length).fill(30);
                const balancedMax = Array(dates.length).fill(60);
                
                // Create new chart
                daysChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: `Days on Market`,
                            data: daysOnMarket,
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.1
                        },
                        {
                            label: 'Balanced Min',
                            data: balancedMin,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Balanced Max',
                            data: balancedMax,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            function updateSaleToListChart(dates, saleToList) {
                const ctx = document.getElementById('saleToListChart').getContext('2d');
                
                // Clear any existing chart
                if (saleToListChart) {
                    saleToListChart.destroy();
                }
                
                // Create balanced market reference lines
                const balancedMin = Array(dates.length).fill(98);
                const balancedMax = Array(dates.length).fill(102);
                
                // Create new chart
                saleToListChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: `Sale-to-List Ratio (%)`,
                            data: saleToList,
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.1
                        },
                        {
                            label: 'Balanced Min',
                            data: balancedMin,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Balanced Max',
                            data: balancedMax,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
            
            function updatePriceDropsChart(dates, priceDrops) {
                const ctx = document.getElementById('priceDropsChart').getContext('2d');
                
                // Clear any existing chart
                if (priceDropsChart) {
                    priceDropsChart.destroy();
                }
                
                // Create balanced market reference lines
                const balancedMin = Array(dates.length).fill(10);
                const balancedMax = Array(dates.length).fill(20);
                
                // Create new chart
                priceDropsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: `Price Drops (%)`,
                            data: priceDrops,
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.1
                        },
                        {
                            label: 'Balanced Min',
                            data: balancedMin,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Balanced Max',
                            data: balancedMax,
                            borderColor: 'rgba(34, 197, 94, 0.3)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            function useSampleData() {
                // Sample data for charts if real data loading fails
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const currentYear = new Date().getFullYear();
                const lastYear = currentYear - 1;
                
                const dates = [
                    ...months.map(m => `${m} ${lastYear}`),
                    ...months.map(m => `${m} ${currentYear}`).slice(0, 6)
                ];
                
                const prices = [350000, 355000, 360000, 365000, 370000, 380000, 385000, 390000, 395000, 400000, 405000, 410000, 412000, 415000, 420000, 425000, 430000, 432000];
                const monthsSupply = [3.2, 3.0, 2.8, 2.5, 2.2, 2.0, 1.8, 1.7, 1.5, 1.4, 1.3, 1.2, 1.1, 1.0, 0.9, 0.8, 0.7, 0.6];
                const daysOnMarket = [25, 23, 20, 18, 15, 14, 13, 12, 11, 10, 9, 8, 7, 7, 6, 6, 5, 5];
                const saleToList = [100.5, 101.2, 102.0, 101.8, 101.0, 100.7, 100.5, 101.0, 101.5, 102.0, 102.5, 103.0, 103.5, 104.0, 104.5, 105.0, 105.5, 106.0];
                const priceDrops = [12, 11, 9, 8, 7, 6, 5, 4, 3, 3, 2, 2, 2, 1, 1, 1, 1, 0];
                
                updateMedianPriceChart(dates, prices);
                updateMonthsSupplyChart(dates, monthsSupply);
                updateDaysOnMarketChart(dates, daysOnMarket);
                updateSaleToListChart(dates, saleToList);
                updatePriceDropsChart(dates, priceDrops);
                
                // Format price with commas
                const formatter = new Intl.NumberFormat('en-US');
                document.getElementById('price-value').textContent = formatter.format(432000);
                
                // Update current value displays with sample data
                document.getElementById('price-growth').textContent = '+6.2%';
                document.getElementById('supply-value').textContent = '0.6';
                document.getElementById('days-value').textContent = '5';
                document.getElementById('sale-to-list-value').textContent = '106.0%';
                document.getElementById('price-drops-value').textContent = '0%';
            }
            
            // Initialize weighted values on page load
            updateWeightedValues();
        });
    </script>
</body>
</html>