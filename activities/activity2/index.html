<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Well-being Index Activity - Principles of Macroeconomics</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- Chart.js for data visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- SheetJS for Excel file handling -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<!-- D3.js for map visualization -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<!-- Custom JavaScript -->
<script src="js/dataLoader.js"></script>
<script src="js/mapVisualizer.js"></script>
<script src="js/main.js"></script>
<style>
  .banner-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 25%; /* This sets the aspect ratio of the container */
    min-height: 150px; /* Slightly taller minimum height to accommodate nav links */
    max-height: 320px; /* Maximum height on large screens */
    overflow: hidden;
    background-color: #1d4ed8; /* bg-blue-700 as fallback */
  }
  
  .banner-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.9; /* Make the image slightly transparent */
  }
  
  .banner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 1.5rem;
  }
  
  .nav-links {
    display: flex;
    flex-direction: column;
    margin-bottom: 0.75rem;
  }
  
  .nav-link {
    color: #bfdbfe; /* text-blue-100 */
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
  }
  
  .nav-link:hover {
    color: white;
  }
  
  .activity-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
    line-height: 1.2;
  }
  
  .activity-date {
    font-size: 0.875rem;
    margin-top: 0.5rem;
    color: #bfdbfe; /* text-blue-100 */
  }
  
  /* Medium screens */
  @media (min-width: 640px) {
    .banner-overlay {
      padding: 1.5rem 2rem;
    }
    
    .nav-links {
      flex-direction: row;
      align-items: center;
    }
    
    .nav-link {
      font-size: 1rem;
      margin-bottom: 0;
    }
    
    .nav-link:not(:first-child) {
      margin-left: 1rem;
    }
    
    .activity-title {
      font-size: 2rem;
    }
    
    .activity-date {
      font-size: 1rem;
    }
  }
  
  /* Large screens */
  @media (min-width: 1024px) {
    .banner-overlay {
      padding: 1.5rem 3rem;
    }
    
    .activity-title {
      font-size: 2.25rem;
    }
  }

  /* Choropleth map styling */
  .country {
    stroke: #fff;
    stroke-width: 0.5px;
  }
  
  .country:hover {
    stroke-width: 2px;
    cursor: pointer;
  }
  
  .tooltip {
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    pointer-events: none;
    font-size: 14px;
  }
</style>
</head>
<body class="bg-gray-50">
<!-- Header -->
<header>
  <div class="banner-container">
    <img src="../../images/banner10.png" alt="Well-being Index Activity Banner" class="banner-image">
    <div class="banner-overlay">
      <div class="container mx-auto">
        <div class="nav-links">
          <a href="../../index.html" class="nav-link">← Back to Course Home</a>
          <a href="../index.html" class="nav-link">← Back to Activities</a>
        </div>
        <h1 class="activity-title">Discussion Activity 2: Well-being Index</h1>
        <p class="activity-date">April 8-11, 2025</p>
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="container mx-auto py-8 px-4">
    <!-- Step Navigation -->
    <div class="flex mb-8 border-b">
        <button id="nav-instructions" class="step-nav font-medium px-4 py-2 border-b-2 border-blue-600 text-blue-600">1. Instructions</button>
        <button id="nav-explore" class="step-nav font-medium px-4 py-2 border-b-2 border-transparent text-gray-500">2. Explore Measures</button>
        <button id="nav-create" class="step-nav font-medium px-4 py-2 border-b-2 border-transparent text-gray-500">3. Create Index</button>
        <button id="nav-compare" class="step-nav font-medium px-4 py-2 border-b-2 border-transparent text-gray-500">4. AI Comparison</button>
    </div>

    <!-- Error Message Container -->
    <div id="error-message" class="bg-red-100 text-red-700 p-4 rounded-lg mb-6 hidden"></div>

    <!-- Steps Content -->
    <div id="step-instructions" class="step-content">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Activity Instructions</h2>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-medium mb-2">Objective</h3>
                    <p class="mb-4">In this activity, you and your group (of 2 to 3) will create your own well-being index to measure economic prosperity beyond traditional Gross Domestic Product (GDP) measures.</p>
                    <p>While GDP is the most common measure of economic well-being, it fails to capture many important aspects of human welfare. This activity will help you understand the limitations of GDP and explore alternative measures.</p>
                </div>
                
                <div class="p-4 bg-blue-50 rounded-lg mb-4">
                    <h3 class="text-lg font-medium mb-2">Activity Overview</h3>
                    <ol class="list-decimal pl-5 space-y-1">
                        <li>First, work with 1-3 peers to form a group</li>
                        <li>Explore GDP per Capita and the Human Development Index (HDI)</li>
                        <li>Create your own well-being index by selecting variables and weights</li>
                        <li>Compare your index with those created by your classmates and an AI</li>
                        <li>Reflect on the implications for economic policy and measurement</li>
                    </ol>
                </div>
                
                <div>
                    <h3 class="text-lg font-medium mb-2">Background</h3>
                    <p class="mb-3">The limitations of GDP as a measure of well-being include:</p>
                    <ul class="list-disc pl-5 space-y-1 mb-4">
                        <li>Ignores income distribution (inequality)</li>
                        <li>Excludes non-market activities (e.g., household work)</li>
                        <li>Doesn't account for environmental degradation</li>
                        <li>Fails to measure social welfare, health, and happiness</li>
                        <li>Counts all production equally, even harmful activities</li>
                    </ul>
                    <p>Alternative measures like the Human Development Index (HDI) incorporate education and health alongside economic factors, but still have limitations. Your task is to design a more comprehensive measure.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-medium mb-2">Key Questions to Consider</h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>What dimensions of human well-being should be included beyond income?</li>
                        <li>How should different factors be weighted relative to each other?</li>
                        <li>Which countries might rank differently on your measure compared to GDP?</li>
                        <li>What policy implications might arise from using your measure?</li>
                    </ul>
                </div>
                
                <div class="flex justify-end">
                    <button id="next-explore" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Next: Explore Measures</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="step-explore" class="step-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Explore Well-being Measures</h2>
            
            <p class="mb-4">Examine how countries rank differently on GDP per Capita versus the Human Development Index (HDI). Notice which countries have significant discrepancies between the two measures.</p>
            
            <!-- Map Controls -->
            <div class="flex space-x-4 mb-4">
                <button id="show-gdp" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Show GDP per Capita</button>
                <button id="show-hdi" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Show HDI</button>
            </div>
            
            <!-- Map Container -->
            <div id="map-container" class="w-full h-96 border rounded-lg mb-6"></div>
            
            <!-- Rankings Table -->
            <div class="overflow-x-auto">
                <table id="rankings-table" class="min-w-full table-auto">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-2 text-left">Country</th>
                            <th class="px-4 py-2 text-left">GDP per Capita</th>
                            <th class="px-4 py-2 text-left">HDI</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <!-- HDI explanation -->
            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="font-medium mb-2">Understanding the Human Development Index (HDI)</h3>
                <p class="mb-3">The HDI combines three key dimensions of human development:</p>
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-white p-3 rounded shadow-sm">
                        <h4 class="font-medium text-blue-700">Health</h4>
                        <p class="text-sm">Measured by life expectancy at birth</p>
                    </div>
                    <div class="bg-white p-3 rounded shadow-sm">
                        <h4 class="font-medium text-green-700">Education</h4>
                        <p class="text-sm">Measured by mean years of schooling and expected years of schooling</p>
                    </div>
                    <div class="bg-white p-3 rounded shadow-sm">
                        <h4 class="font-medium text-purple-700">Standard of Living</h4>
                        <p class="text-sm">Measured by GNI per capita (PPP $)</p>
                    </div>
                </div>
                <p class="mt-3 text-sm">The final HDI is calculated as the geometric mean of normalized indices for each of these dimensions.</p>
            </div>
            
            <div class="flex justify-between mt-6">
                <button id="back-to-instructions" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Instructions</button>
                <button id="next-to-create" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Next: Create Your Index</button>
            </div>
        </div>
    </div>
    
    <div id="step-create" class="step-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Create Your Well-Being Index</h2>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="font-medium mb-2">How to Create Your Index:</h3>
                <ol class="list-decimal pl-5 space-y-1">
                    <li>Review the variable categories below</li>
                    <li>Select up to 7 variables that you think best capture human well-being</li>
                    <li>Assign weights to each variable (weights must sum to 100%)</li>
                    <li>Name your index and provide a brief justification</li>
                </ol>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6">
                <!-- Variable Selection Panel -->
                <div class="md:col-span-1">
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-medium mb-3">Variable Categories</h3>
                        
                        <!-- Economic Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-blue-100 rounded-t-lg font-medium text-blue-800" onclick="toggleCategory('economic')">
                                Economic Factors
                                <span id="economic-toggle" class="float-right">▼</span>
                            </button>
                            <div id="economic-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="gdp_per_capita" data-category="economic">
                                        <div class="font-medium">GDP per Capita</div>
                                        <div class="text-sm text-gray-600">Total economic output per person</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="gini" data-category="economic">
                                        <div class="font-medium">Income Inequality (GINI)</div>
                                        <div class="text-sm text-gray-600">Measure of income distribution inequality</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="poverty_rate" data-category="economic">
                                        <div class="font-medium">Poverty Rate</div>
                                        <div class="text-sm text-gray-600">Percentage below poverty line</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="unemployment" data-category="economic">
                                        <div class="font-medium">Unemployment Rate</div>
                                        <div class="text-sm text-gray-600">Percentage without employment</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Health Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-green-100 rounded-t-lg font-medium text-green-800" onclick="toggleCategory('health')">
                                Health & Wellness
                                <span id="health-toggle" class="float-right">▼</span>
                            </button>
                            <div id="health-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="life_expectancy" data-category="health">
                                        <div class="font-medium">Life Expectancy</div>
                                        <div class="text-sm text-gray-600">Average years of life at birth</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="infant_mortality" data-category="health">
                                        <div class="font-medium">Infant Mortality Rate</div>
                                        <div class="text-sm text-gray-600">Deaths per 1,000 live births</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="healthcare_access" data-category="health">
                                        <div class="font-medium">Healthcare Access</div>
                                        <div class="text-sm text-gray-600">Percentage with healthcare access</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="mental_health" data-category="health">
                                        <div class="font-medium">Mental Health</div>
                                        <div class="text-sm text-gray-600">Prevalence of mental well-being</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Education Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-yellow-100 rounded-t-lg font-medium text-yellow-800" onclick="toggleCategory('education')">
                                Education & Knowledge
                                <span id="education-toggle" class="float-right">▼</span>
                            </button>
                            <div id="education-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="literacy" data-category="education">
                                        <div class="font-medium">Literacy Rate</div>
                                        <div class="text-sm text-gray-600">Percentage that can read and write</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="years_education" data-category="education">
                                        <div class="font-medium">Years of Education</div>
                                        <div class="text-sm text-gray-600">Average years of schooling</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="education_quality" data-category="education">
                                        <div class="font-medium">Education Quality</div>
                                        <div class="text-sm text-gray-600">Standardized test scores</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-teal-100 rounded-t-lg font-medium text-teal-800" onclick="toggleCategory('environment')">
                                Environment & Sustainability
                                <span id="environment-toggle" class="float-right">▼</span>
                            </button>
                            <div id="environment-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="co2_emissions" data-category="environment">
                                        <div class="font-medium">CO2 Emissions</div>
                                        <div class="text-sm text-gray-600">Carbon emissions per capita</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="renewable_energy" data-category="environment">
                                        <div class="font-medium">Renewable Energy</div>
                                        <div class="text-sm text-gray-600">Percentage of energy from renewables</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="air_quality" data-category="environment">
                                        <div class="font-medium">Air Quality Index</div>
                                        <div class="text-sm text-gray-600">Measure of air pollution levels</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="biodiversity" data-category="environment">
                                        <div class="font-medium">Biodiversity Protection</div>
                                        <div class="text-sm text-gray-600">Conservation efforts and outcomes</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Social Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-purple-100 rounded-t-lg font-medium text-purple-800" onclick="toggleCategory('social')">
                                Social & Community
                                <span id="social-toggle" class="float-right">▼</span>
                            </button>
                            <div id="social-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="social_support" data-category="social">
                                        <div class="font-medium">Social Support</div>
                                        <div class="text-sm text-gray-600">Having someone to count on</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="gender_equality" data-category="social">
                                        <div class="font-medium">Gender Equality</div>
                                        <div class="text-sm text-gray-600">Women's rights and opportunities</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="safety" data-category="social">
                                        <div class="font-medium">Safety & Security</div>
                                        <div class="text-sm text-gray-600">Crime rates and perceived safety</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="community_engagement" data-category="social">
                                        <div class="font-medium">Community Engagement</div>
                                        <div class="text-sm text-gray-600">Volunteerism and civic participation</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Governance Variables -->
                        <div class="mb-4">
                            <button class="w-full text-left px-3 py-2 bg-red-100 rounded-t-lg font-medium text-red-800" onclick="toggleCategory('governance')">
                                Governance & Rights
                                <span id="governance-toggle" class="float-right">▼</span>
                            </button>
                            <div id="governance-variables" class="border border-t-0 rounded-b-lg p-3">
                                <div class="space-y-2">
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="democracy" data-category="governance">
                                        <div class="font-medium">Democratic Participation</div>
                                        <div class="text-sm text-gray-600">Voting rights and election quality</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="corruption" data-category="governance">
                                        <div class="font-medium">Corruption Index</div>
                                        <div class="text-sm text-gray-600">Perception of public sector corruption</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="press_freedom" data-category="governance">
                                        <div class="font-medium">Press Freedom</div>
                                        <div class="text-sm text-gray-600">Independence of media</div>
                                    </div>
                                    <div class="variable-option p-2 hover:bg-gray-100 rounded cursor-pointer" data-id="human_rights" data-category="governance">
                                        <div class="font-medium">Human Rights</div>
                                        <div class="text-sm text-gray-600">Basic rights protections</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Selected Variables Panel -->
                <div class="md:col-span-2">
                    <div class="border rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-medium mb-3">Your Selected Variables</h3>
                        
                        <div id="weight-warning" class="hidden text-red-600 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            Weights must sum to 100%. Please adjust your weights.
                        </div>
                        
                        <div id="no-variables-message" class="text-center py-6 bg-gray-50 rounded">
                            <p class="text-gray-500">Select variables from the left panel to build your index</p>
                            <p class="text-gray-400 text-sm mt-2">(Click on a variable to add it)</p>
                        </div>
                        
                        <div id="selected-variables-container" class="hidden space-y-4">
                            <!-- Selected variables will be added here -->
                        </div>
                        
                        <div class="mt-4 pt-4 border-t">
                            <div class="flex justify-between items-center">
                                <h4 class="font-medium">Total Weight:</h4>
                                <div id="total-weight" class="font-medium text-lg">0%</div>
                            </div>
                            <div class="w-full bg-gray-200 h-2 rounded-full mt-2">
                                <div id="weight-progress" class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Index Name and Justification -->
                    <div class="border rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-medium mb-3">Name and Justify Your Index</h3>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2" for="index-name">
                                Index Name
                            </label>
                            <input type="text" id="index-name" class="w-full border rounded px-3 py-2" placeholder="e.g., Sustainable Development Index">
                            <div class="text-sm text-gray-500 mt-1">Give your index a descriptive name that reflects its focus</div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="index-justification">
                                Justification (Why these variables? What aspect of well-being does your index measure?)
                            </label>
                            <textarea id="index-justification" class="w-full border rounded px-3 py-2 h-24" placeholder="Explain why you selected these variables and weights..."></textarea>
                            <div class="text-sm text-gray-500 mt-1">Max 250 characters. <span id="char-count">250</span> remaining.</div>
                        </div>
                    </div>
                    
                    <!-- Index Preview -->
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-medium mb-3">Index Preview</h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <h4 class="font-medium mb-2">Top 5 Countries (Your Index)</h4>
                                <div id="top-countries" class="bg-gray-50 p-3 rounded">
                                    <p class="text-gray-400 text-center py-3">Select variables and assign weights to see rankings</p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-2">Bottom 5 Countries (Your Index)</h4>
                                <div id="bottom-countries" class="bg-gray-50 p-3 rounded">
                                    <p class="text-gray-400 text-center py-3">Select variables and assign weights to see rankings</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-medium mb-2">Weight Distribution</h4>
                            <div class="h-64">
                                <canvas id="weight-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-medium mb-2">Biggest Changes from GDP Rankings</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <h5 class="text-sm font-medium text-green-600 mb-1">Winners (Ranked Higher)</h5>
                                    <div id="winners-list" class="bg-gray-50 p-3 rounded">
                                        <p class="text-gray-400 text-center py-2">Assign weights to see changes</p>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium text-red-600 mb-1">Losers (Ranked Lower)</h5>
                                    <div id="losers-list" class="bg-gray-50 p-3 rounded">
                                        <p class="text-gray-400 text-center py-2">Assign weights to see changes</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between mt-6">
                <button id="back-to-explore" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Explore</button>
                <button id="next-to-compare" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700" disabled>Next: AI Comparison</button>
            </div>
        </div>
    </div>
    
    <div id="step-compare" class="step-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Compare with AI Analysis</h2>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="font-medium mb-2">Final Steps:</h3>
                <ol class="list-decimal pl-5 space-y-1">
                    <li>Download your index spreadsheet</li>
                    <li>Upload it to the class Google Sheet (link provided by your TA)</li>
                    <li>Observe what an AI created as an optimal well-being index</li>
                    <li>Compare your index with the AI's approach</li>
                    <li>Complete your reflection questions</li>
                </ol>
            </div>
            
            <!-- Your Index Summary -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Your Index Summary</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="border rounded-lg p-4">
                        <h4 class="font-medium" id="summary-index-name">Your Index Name</h4>
                        <p class="text-sm text-gray-600 mb-3" id="summary-justification">Your justification will appear here...</p>
                        
                        <h5 class="font-medium text-sm text-gray-700 mb-1">Selected Variables & Weights:</h5>
                        <div id="summary-variables" class="bg-gray-50 p-3 rounded text-sm">
                            <p class="text-gray-400">Your variables will appear here</p>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <h4 class="font-medium mb-2">Weight Distribution</h4>
                        <div class="h-40">
                            <canvas id="summary-weight-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Index -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">AI-Generated Well-being Index</h3>
                <div class="bg-purple-50 border border-purple-100 rounded-lg p-4">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-purple-800">Comprehensive Quality of Life Index</h4>
                            <p class="text-sm mb-4">This index balances economic prosperity with social well-being, health outcomes, environmental sustainability, and governance quality to provide a holistic measure of human flourishing across multiple dimensions.</p>
                            
                            <h5 class="font-medium text-sm text-gray-700 mb-1">Selected Variables & Weights:</h5>
                            <ul class="text-sm space-y-1">
                                <li class="flex justify-between">
                                    <span>• Income Equality (GINI)</span>
                                    <span class="font-medium">15%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Life Expectancy</span>
                                    <span class="font-medium">20%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Education Quality</span>
                                    <span class="font-medium">15%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Environmental Quality</span>
                                    <span class="font-medium">15%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Healthcare Access</span>
                                    <span class="font-medium">15%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Democratic Participation</span>
                                    <span class="font-medium">10%</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>• Social Support</span>
                                    <span class="font-medium">10%</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-medium mb-2">AI Weight Distribution</h4>
                            <div class="h-48">
                                <canvas id="ai-weight-chart"></canvas>
                            </div>
                            <div class="mt-2">
                                <h5 class="font-medium text-sm">Key Differences from GDP Rankings:</h5>
                                <ul class="text-sm space-y-1 mt-1">
                                    <li>• Countries with strong social safety nets rank higher</li>
                                    <li>• Oil-rich nations with poor governance rank lower</li>
                                    <li>• Nations with environmental protection emphasized</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Class Comparisons -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Class Index Comparison</h3>
                <div class="p-4 border rounded-lg">
                    <p class="mb-4">After all groups submit their indices, you'll be able to see aggregate data about the class preferences. Your TA will guide you through this discussion.</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-medium mb-2">Most Commonly Selected Variables</h4>
                            <div class="h-48">
                                <canvas id="common-variables-chart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium mb-2">Average Weights by Category</h4>
                            <div class="h-48">
                                <canvas id="category-weights-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Download Button -->
            <div class="bg-green-50 border border-green-100 rounded-lg p-4 mb-6">
                <div class="flex items-start">
                    <div class="mt-1 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h4 class="font-medium">Download Your Index Data</h4>
                        <p class="text-sm text-gray-600 mb-3">Download your index data to upload to the class Google Sheet.</p>
                        <button id="download-button" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            Download Excel File
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Reflection Questions -->
            <div class="border-t pt-6 mt-6">
                <h3 class="text-lg font-medium mb-3">Reflection Questions</h3>
                <p class="mb-4">Answer these questions in your worksheet and be prepared to discuss them in class:</p>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium mb-2">Question 1</h4>
                        <p>After examining the GDP per Capita and HDI rankings across countries, identify at least one country that ranks significantly differently on these two measures. What factors might explain this discrepancy?</p>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium mb-2">Question 2</h4>
                        <p>How does your ranking differ from the standard HDI or GDP per capita rankings, and what specific aspects of well-being does your index emphasize that might explain these differences?</p>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium mb-2">Question 3</h4>
                        <p>After examining both your classmates' well-being indices and the AI-generated index, what significant differences do you notice in variable selection and weighting?</p>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium mb-2">Question 4</h4>
                        <p>Looking at the AI-generated well-being index alongside the class indices, which approach do you find more convincing as a tool for guiding policy decisions, and why?</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between mt-6">
                <button id="back-to-create" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Back to Create Index</button>
                <button id="finish-activity" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Complete Activity</button>
            </div>
        </div>
    </div>
    
    <!-- Completion Modal -->
    <div id="completion-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-lg w-full">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">Activity Completed!</h2>
                <button id="close-modal-x" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <p class="mb-4">You have successfully completed the Well-being Index Activity.</p>
            
            <div class="p-4 bg-green-50 rounded-lg mb-4">
                <p class="mb-2"><strong>Next Steps:</strong></p>
                <ol class="list-decimal pl-5 space-y-1">
                    <li>Submit your index data to the class Google Sheet</li>
                    <li>Complete your written responses to the reflection questions</li>
                    <li>Prepare to discuss your index in the next class session</li>
                </ol>
            </div>
            
            <div class="flex justify-end">
                <button id="close-modal" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    Close
                </button>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="bg-gray-100 border-t mt-12 py-6 px-4">
    <div class="container mx-auto">
        <p class="text-gray-600"> 2025 Economics Department</p>
    </div>
</footer>

<!-- JavaScript -->
<script>
// Add this entire script before the closing </body> tag in your HTML file

document.addEventListener('DOMContentLoaded', function() {
    // Step 1: Handle navigation between tabs
    setupNavigation();
    
    // Step 2: Load data and initialize visualizations
    loadData();
    
    // Step 3: Set up variable selection functionality
    setupVariableSelection();
});

// =============================================
// DATA LOADING AND VISUALIZATION FUNCTIONS
// =============================================

// Load all required data
function loadData() {
  // Load the GeoJSON data for country shapes and the Excel data
  Promise.all([
    fetch('countries.geo.json').then(response => response.json()),
    processExcelData() // Process Excel data
  ])
  .then(([geoData, countryData]) => {
    // Check if data was loaded properly
    if (!countryData || !countryData.countries || countryData.countries.length === 0) {
      console.error('Country data was not loaded properly, falling back to sample data');
      countryData = loadSampleData();
    }
    
    // Initialize visualizations
    initializeMap(geoData, countryData);
    populateRankingsTable(countryData);
    setupMapTypeChanges(geoData, countryData);
  })
  .catch(error => {
    console.error('Error loading data:', error);
    
    // Fallback to sample data if there's an error
    loadSampleData().then(sampleData => {
      fetch('countries.geo.json')
        .then(response => response.json())
        .then(geoData => {
          initializeMap(geoData, sampleData);
          populateRankingsTable(sampleData);
          setupMapTypeChanges(geoData, sampleData);
        });
    });
  });
}

// Function to process the Excel data
async function processExcelData() {
  try {
    // Fetch the Excel file
    const response = await fetch('UNHDIGDPData.xlsx');
    const arrayBuffer = await response.arrayBuffer();
    
    // Process the Excel file using SheetJS
    const data = new Uint8Array(arrayBuffer);
    const workbook = XLSX.read(data, { type: 'array' });
    
    // Assume the first sheet contains our data
    const firstSheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[firstSheetName];
    
    // Convert to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Log for debugging
    console.log('Successfully loaded Excel data:', jsonData.slice(0, 3));
    
    // Process the data for our visualization
    // We expect columns like: Country, CountryCode, HDI, GDP_per_capita
    const processedData = {
      countries: jsonData.map((row, index) => {
        // Determine the country code - check multiple possible column names
        let countryCode = row.ISO3 || row.CountryCode || row.id;
        if (!countryCode && row.Country) {
          // If no code is found but we have a country name, generate a placeholder code
          countryCode = row.Country.substring(0, 3).toUpperCase();
        } else if (!countryCode) {
          // Last resort, generate a code from the index
          countryCode = `COUNTRY${index}`;
        }
        
        return {
          id: countryCode,
          name: row.Country || row.CountryName || row.Name || `Country ${index}`,
          gdpValue: row.GDP_per_capita || row.GDP || row.GDPperCapita || 0,
          hdiValue: row.HDI || row.HumanDevelopmentIndex || 0
        };
      })
    };
    
    // Calculate rankings for GDP and HDI
    // Sort countries by GDP (higher values get better ranks)
    const gdpSorted = [...processedData.countries].sort((a, b) => b.gdpValue - a.gdpValue);
    gdpSorted.forEach((country, index) => {
      const originalCountry = processedData.countries.find(c => c.id === country.id);
      if (originalCountry) {
        originalCountry.gdpRank = index + 1;
      }
    });
    
    // Sort countries by HDI (higher values get better ranks)
    const hdiSorted = [...processedData.countries].sort((a, b) => b.hdiValue - a.hdiValue);
    hdiSorted.forEach((country, index) => {
      const originalCountry = processedData.countries.find(c => c.id === country.id);
      if (originalCountry) {
        originalCountry.hdiRank = index + 1;
        originalCountry.difference = originalCountry.gdpRank - originalCountry.hdiRank;
      }
    });
    
    // Log processed data for debugging
    console.log('Processed country data:', processedData.countries.slice(0, 3));
    
    return processedData;
  } catch (error) {
    console.error('Error processing Excel data:', error);
    // Return sample data as fallback
    return loadSampleData();
  }
}

function initializeMap(geoData, countryData) {
  const mapContainer = document.getElementById('map-container');
  mapContainer.innerHTML = ''; // Clear any loading indicators
  
  // Map dimensions
  const width = mapContainer.clientWidth;
  const height = mapContainer.clientHeight;
  
  // Create the SVG element
  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svg.setAttribute('width', width);
  svg.setAttribute('height', height);
  svg.setAttribute('viewBox', '0 0 960 480');
  svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
  mapContainer.appendChild(svg);
  
  // Create tooltip div
  const tooltip = document.createElement('div');
  tooltip.className = 'tooltip';
  tooltip.style.display = 'none';
  mapContainer.appendChild(tooltip);
  
  // Get the selected map type
  const mapType = 'gdp'; // Default to GDP
  
  // Function to get color based on rank
  function getColor(rank) {
    if (!rank) return '#eee'; // No data
    
    // Colors from light to dark blue
    if (rank <= 10) return '#1e40af'; // Very high (dark blue)
    if (rank <= 25) return '#3b82f6'; // High
    if (rank <= 50) return '#60a5fa'; // Medium
    if (rank <= 100) return '#93c5fd'; // Low
    return '#dbeafe'; // Very low (light blue)
  }
  
  // Function to get data based on selected map type
  function getCountryData(countryId) {
    // Find country by ID (matching the GeoJSON ID)
    const country = countryData.countries.find(c => c.id === countryId);
    if (!country) return null;
    
    switch (mapType) {
      case 'gdp': return country.gdpRank;
      case 'hdi': return country.hdiRank;
      default: return null;
    }
  }
  
  // Draw each country
  geoData.features.forEach(feature => {
    const countryPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    
    // Create a path for the country
    const d3Path = generatePathFromGeoJSON(feature.geometry);
    countryPath.setAttribute('d', d3Path);
    countryPath.setAttribute('class', 'country');
    
    // Get country data and set fill color
    const countryId = feature.id;
    const value = getCountryData(countryId);
    countryPath.setAttribute('fill', getColor(value));
    
    // Store country info for tooltip
    countryPath.dataset.id = countryId;
    countryPath.dataset.name = feature.properties.name;
    countryPath.dataset.value = value;
    
    // Add event listeners for tooltips
    countryPath.addEventListener('mouseover', function(e) {
      const country = countryData.countries.find(c => c.id === this.dataset.id);
      if (country) {
        tooltip.innerHTML = `
          <strong>${country.name}</strong><br>
          GDP Rank: ${country.gdpRank || 'N/A'}<br>
          HDI Rank: ${country.hdiRank || 'N/A'}<br>
          Difference: ${country.difference || 'N/A'}
        `;
        tooltip.style.display = 'block';
        tooltip.style.left = e.pageX + 10 + 'px';
        tooltip.style.top = e.pageY + 10 + 'px';
        
        // Highlight the country
        this.setAttribute('stroke-width', '2px');
      }
    });
    
    countryPath.addEventListener('mousemove', function(e) {
      tooltip.style.left = e.pageX + 10 + 'px';
      tooltip.style.top = e.pageY + 10 + 'px';
    });
    
    countryPath.addEventListener('mouseout', function() {
      tooltip.style.display = 'none';
      this.setAttribute('stroke-width', '0.5px');
    });
    
    svg.appendChild(countryPath);
  });
}

// Function to generate path data from GeoJSON (simple version)
function generatePathFromGeoJSON(geometry) {
  // This function converts GeoJSON coordinates to SVG path data
  // We use a simple mercator projection for this example
  
  // Scale and offset parameters for the projection
  const scale = 100;
  const offsetX = 480;
  const offsetY = 250;
  
  let path = '';
  
  // Process different types of geometries
  function processCoordinates(coords) {
    let result = '';
    for (let i = 0; i < coords.length; i++) {
      // Project coordinates to pixels
      const x = coords[i][0] * scale + offsetX;
      const y = -coords[i][1] * scale + offsetY; // Flip Y coordinates
      result += (i === 0 ? 'M' : 'L') + x + ',' + y;
    }
    return result + 'Z'; // Close the path
  }
  
  if (geometry.type === 'Polygon') {
    // Process each ring in the polygon
    geometry.coordinates.forEach(ring => {
      path += processCoordinates(ring);
    });
  } else if (geometry.type === 'MultiPolygon') {
    // Process each polygon in the multi-polygon
    geometry.coordinates.forEach(polygon => {
      polygon.forEach(ring => {
        path += processCoordinates(ring);
      });
    });
  }
  
  return path;
}

// Populate the rankings table
function populateRankingsTable(countryData) {
  const tableBody = document.querySelector('#rankings-table tbody');
  tableBody.innerHTML = ''; // Clear existing content
  
  // Sort countries by GDP rank for initial display
  const sortedCountries = [...countryData.countries].sort((a, b) => a.gdpRank - b.gdpRank);
  
  // Add rows to the table
  sortedCountries.forEach(country => {
    const row = document.createElement('tr');
    
    // Add a class for highlighting differences
    if (country.difference && Math.abs(country.difference) >= 5) {
      row.classList.add(country.difference > 0 ? 'bg-green-50' : 'bg-red-50');
    }
    
    // Create cells
    const nameCell = document.createElement('td');
    nameCell.textContent = country.name;
    nameCell.className = 'px-4 py-2 border';
    
    const gdpCell = document.createElement('td');
    gdpCell.textContent = country.gdpRank || 'N/A';
    gdpCell.className = 'px-4 py-2 border text-center';
    
    const hdiCell = document.createElement('td');
    hdiCell.textContent = country.hdiRank || 'N/A';
    hdiCell.className = 'px-4 py-2 border text-center';
    
    // Add cells to the row
    row.appendChild(nameCell);
    row.appendChild(gdpCell);
    row.appendChild(hdiCell);
    
    // Add the row to the table
    tableBody.appendChild(row);
  });
}

// Set up the map type change event handler
function setupMapTypeChanges(geoData, countryData) {
    document.getElementById('show-gdp').addEventListener('click', function() {
        initializeMap(geoData, countryData);
    });
    
    document.getElementById('show-hdi').addEventListener('click', function() {
        initializeMap(geoData, countryData);
    });
}

// =============================================
// NAVIGATION FUNCTIONS
// =============================================

// Set up navigation between steps
function setupNavigation() {
    // Get all navigation buttons
    const navButtons = document.querySelectorAll('.step-nav');
    const stepContents = document.querySelectorAll('.step-content');
    
    // Navigation button click handler
    function handleNavClick(event) {
        const targetId = event.target.id.replace('nav-', '');
        
        // Update navigation buttons
        navButtons.forEach(button => {
            if (button.id === event.target.id) {
                button.classList.add('border-blue-600', 'text-blue-600');
                button.classList.remove('border-transparent', 'text-gray-500');
            } else {
                button.classList.remove('border-blue-600', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            }
        });
        
        // Show the target content, hide others
        stepContents.forEach(content => {
            if (content.id === `step-${targetId}`) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
        });
        
        // Initialize charts when showing the compare tab
        if (targetId === 'compare') {
            setTimeout(initializeCharts, 100); // Short delay to ensure elements are visible
        }
    }
    
    // Add click listeners to all navigation buttons
    navButtons.forEach(button => {
        button.addEventListener('click', handleNavClick);
    });
    
    // Set up next/back button handlers
    document.getElementById('next-explore').addEventListener('click', function() {
        document.getElementById('nav-explore').click();
    });
    
    document.getElementById('back-to-instructions').addEventListener('click', function() {
        document.getElementById('nav-instructions').click();
    });
    
    document.getElementById('next-to-create').addEventListener('click', function() {
        document.getElementById('nav-create').click();
    });
    
    document.getElementById('back-to-explore').addEventListener('click', function() {
        document.getElementById('nav-explore').click();
    });
    
    document.getElementById('next-to-compare').addEventListener('click', function() {
        document.getElementById('nav-compare').click();
        
        // Update summary with selected variables
        updateSummary();
    });
    
    document.getElementById('back-to-create').addEventListener('click', function() {
        document.getElementById('nav-create').click();
    });
    
    // Set up completion modal
    document.getElementById('finish-activity').addEventListener('click', function() {
        document.getElementById('completion-modal').classList.remove('hidden');
    });
    
    document.getElementById('close-modal').addEventListener('click', function() {
        document.getElementById('completion-modal').classList.add('hidden');
    });
    
    document.getElementById('close-modal-x').addEventListener('click', function() {
        document.getElementById('completion-modal').classList.add('hidden');
    });
}

// Function to toggle category visibility
window.toggleCategory = function(category) {
    const variables = document.getElementById(`${category}-variables`);
    const toggle = document.getElementById(`${category}-toggle`);
    
    if (variables.style.display === 'none') {
        variables.style.display = 'block';
        toggle.textContent = '▼';
    } else {
        variables.style.display = 'none';
        toggle.textContent = '►';
    }
};

// Update the summary in the compare tab
function updateSummary() {
    // Get the index name and justification
    const indexName = document.getElementById('index-name').value || 'Custom Well-being Index';
    const justification = document.getElementById('index-justification').value || 'No justification provided';
    
    // Update the summary section
    document.getElementById('summary-index-name').textContent = indexName;
    document.getElementById('summary-justification').textContent = justification;
    
    // Get selected variables
    const selectedVariables = document.querySelectorAll('.selected-variable-item');
    
    // Create a list of variables and weights
    let variablesList = '';
    selectedVariables.forEach(item => {
        const name = item.querySelector('.font-medium').textContent;
        const weight = item.querySelector('.weight-input').value;
        variablesList += `<div class="flex justify-between"><span>• ${name}</span><span class="font-medium">${weight}%</span></div>`;
    });
    
    // Update the summary variables
    if (variablesList) {
        document.getElementById('summary-variables').innerHTML = variablesList;
    } else {
        document.getElementById('summary-variables').innerHTML = '<p class="text-gray-400">No variables selected</p>';
    }
}

// Initialize charts for the compare page
function initializeCharts() {
    // Get the selected variables and their weights
    const selectedItems = document.querySelectorAll('.selected-variable-item');
    const categories = {};
    const labels = [];
    const data = [];
    
    // Group variables by category and collect data
    selectedItems.forEach(item => {
        const category = item.dataset.category || 'other';
        const weight = parseInt(item.querySelector('.weight-input').value);
        
        if (!categories[category]) {
            categories[category] = 0;
        }
        
        categories[category] += weight;
        
        labels.push(item.querySelector('.font-medium').textContent);
        data.push(weight);
    });
    
    // If we have selected variables, update the chart
    if (labels.length > 0) {
        // Create summary weight chart
        new Chart(document.getElementById('summary-weight-chart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#3b82f6', // blue
                        '#10b981', // green
                        '#f59e0b', // yellow
                        '#14b8a6', // teal
                        '#8b5cf6', // purple
                        '#ef4444', // red
                        '#ec4899', // pink
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });
    }
    
    // AI weight chart (static for demo)
    new Chart(document.getElementById('ai-weight-chart').getContext('2d'), {
        type: 'pie',
        data: {
            labels: ['Income Equality', 'Life Expectancy', 'Education Quality', 'Environmental Quality', 'Healthcare Access', 'Democratic Participation', 'Social Support'],
            datasets: [{
                data: [15, 20, 15, 15, 15, 10, 10],
                backgroundColor: [
                    '#3b82f6', // blue
                    '#10b981', // green
                    '#f59e0b', // yellow
                    '#14b8a6', // teal
                    '#8b5cf6', // purple
                    '#ef4444', // red
                    '#ec4899', // pink
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        font: {
                            size: 10
                        }
                    }
                }
            }
        }
    });
    
    // Common variables chart (static for demo)
    new Chart(document.getElementById('common-variables-chart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Life Expectancy', 'GDP per Capita', 'Education', 'Healthcare Access', 'Income Inequality'],
            datasets: [{
                label: 'Times Selected',
                data: [18, 15, 12, 10, 8],
                backgroundColor: '#3b82f6'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 20
                }
            }
        }
    });
    
    // Category weights chart (static for demo)
    new Chart(document.getElementById('category-weights-chart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Economic', 'Health', 'Education', 'Environment', 'Social', 'Governance'],
            datasets: [{
                label: 'Average Weight (%)',
                data: [22, 25, 18, 12, 13, 10],
                backgroundColor: [
                    '#3b82f6', // blue
                    '#10b981', // green
                    '#f59e0b', // yellow
                    '#14b8a6', // teal
                    '#8b5cf6', // purple
                    '#ef4444', // red
                ]
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 30
                }
            }
        }
    });
}

// =============================================
// VARIABLE SELECTION FUNCTIONS
// =============================================

// Set up variable selection functionality
function setupVariableSelection() {
    // Handle variable selection
    const variableOptions = document.querySelectorAll('.variable-option');
    variableOptions.forEach(option => {
        option.addEventListener('click', function() {
            const variableId = this.dataset.id;
            const category = this.dataset.category;
            const name = this.querySelector('.font-medium').textContent;
            const description = this.querySelector('.text-sm').textContent;
            
            addSelectedVariable(variableId, category, name, description);
        });
    });
    
    // Handle character count for justification
    const justificationField = document.getElementById('index-justification');
    const charCount = document.getElementById('char-count');
    
    justificationField.addEventListener('input', function() {
        const remaining = 250 - this.value.length;
        charCount.textContent = remaining;
        
        if (remaining < 0) {
            charCount.classList.add('text-red-600');
        } else {
            charCount.classList.remove('text-red-600');
        }
    });
    
    // Handle the download button
    document.getElementById('download-button').addEventListener('click', function() {
        // Get all selected variables and their weights
        const variables = Array.from(document.querySelectorAll('.selected-variable-item')).map(item => {
            const id = item.id.replace('selected-', '');
            const name = item.querySelector('.font-medium').textContent;
            const weight = item.querySelector('.weight-input').value;
            return { id, name, weight };
        });
        
        // Get index name and justification
        const indexName = document.getElementById('index-name').value || 'Custom Well-being Index';
        const justification = document.getElementById('index-justification').value || 'No justification provided';
        
        // Create workbook
        const wb = XLSX.utils.book_new();
        
        // Create worksheet with index info
        const wsData = [
            ['Index Name', indexName],
            ['Justification', justification],
            [''],
            ['Variable', 'Weight (%)']
        ];
        
        variables.forEach(variable => {
            wsData.push([variable.name, variable.weight]);
        });
        
        const ws = XLSX.utils.aoa_to_sheet(wsData);
        XLSX.utils.book_append_sheet(wb, ws, 'My Index');
        
        // Save the file
        XLSX.writeFile(wb, `${indexName.replace(/[^a-z0-9]/gi, '_')}.xlsx`);
    });
}

// Add a selected variable to the list
function addSelectedVariable(id, category, name, description) {
    // Check if already selected
    if (document.getElementById(`selected-${id}`)) {
        alert('This variable is already selected.');
        return;
    }
    
    // Check if we have too many variables
    const selectedCount = document.querySelectorAll('.selected-variable-item').length;
    if (selectedCount >= 7) {
        alert('You can select a maximum of 7 variables.');
        return;
    }
    
    // Hide the "no variables" message
    document.getElementById('no-variables-message').classList.add('hidden');
    document.getElementById('selected-variables-container').classList.remove('hidden');
    
    // Create the variable item
    const item = document.createElement('div');
    item.id = `selected-${id}`;
    item.className = 'selected-variable-item p-3 border rounded bg-white';
    item.dataset.category = category;
    
    // Get color class based on category
    let colorClass = 'blue';
    switch(category) {
        case 'economic': colorClass = 'blue'; break;
        case 'health': colorClass = 'green'; break;
        case 'education': colorClass = 'yellow'; break;
        case 'environment': colorClass = 'teal'; break;
        case 'social': colorClass = 'purple'; break;
        case 'governance': colorClass = 'red'; break;
    }
    
    // Create the content
    item.innerHTML = `
        <div class="flex justify-between items-center mb-2">
            <div class="font-medium bg-${colorClass}-100 text-${colorClass}-800 px-2 py-1 rounded text-sm">${name}</div>
            <button class="remove-variable text-red-500 hover:text-red-700" data-id="${id}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <div class="text-sm text-gray-600 mb-3">${description}</div>
        <div class="flex items-center">
            <label class="mr-2 text-sm font-medium">Weight:</label>
            <input type="range" class="weight-slider flex-grow" min="0" max="100" value="10" data-id="${id}">
            <span class="weight-value ml-2 text-sm font-medium">10%</span>
            <input type="hidden" class="weight-input" data-id="${id}" value="10">
        </div>
    `;
    
    // Add the item to the container
    document.getElementById('selected-variables-container').appendChild(item);
    
    // Add event listeners
    item.querySelector('.remove-variable').addEventListener('click', function() {
        removeSelectedVariable(this.dataset.id);
    });
    
    const slider = item.querySelector('.weight-slider');
    const weightValue = item.querySelector('.weight-value');
    const weightInput = item.querySelector('.weight-input');
    
    slider.addEventListener('input', function() {
        weightValue.textContent = this.value + '%';
        weightInput.value = this.value;
        updateTotalWeight();
    });
    
    // Update total weight
    updateTotalWeight();
    
    // Enable the next button if we have at least one variable
    document.getElementById('next-to-compare').disabled = selectedCount === 0;
}

// Remove a selected variable
function removeSelectedVariable(id) {
    const item = document.getElementById(`selected-${id}`);
    if (item) {
        item.remove();
        
        // Show the "no variables" message if none left
        const selectedCount = document.querySelectorAll('.selected-variable-item').length;
        if (selectedCount === 0) {
            document.getElementById('no-variables-message').classList.remove('hidden');
            document.getElementById('selected-variables-container').classList.add('hidden');
            document.getElementById('next-to-compare').disabled = true;
        }
        
        // Update total weight
        updateTotalWeight();
    }
}

// Update the total weight display
function updateTotalWeight() {
    const weightInputs = document.querySelectorAll('.weight-input');
    let total = 0;
    
    weightInputs.forEach(input => {
        total += parseInt(input.value);
    });
    
    document.getElementById('total-weight').textContent = total + '%';
    document.getElementById('weight-progress').style.width = total + '%';
    
    // Show warning if total is not 100%
    if (total !== 100 && weightInputs.length > 0) {
        document.getElementById('weight-warning').classList.remove('hidden');
        document.getElementById('next-to-compare').disabled = true;
    } else {
        document.getElementById('weight-warning').classList.add('hidden');
        document.getElementById('next-to-compare').disabled = weightInputs.length === 0;
    }
}
</script>
</body>
</html>